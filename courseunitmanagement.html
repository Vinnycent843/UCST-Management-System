<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UCST - Course Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #007bff;
            --primary-dark: #212529;
            --primary-light: #f8f9fa;
            --success-green: #28a745;
            --warning-orange: #ffc107;
            --danger-red: #dc3545;
            --purple: #6f42c1;
            --teal: #20c997;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Georgia, 'Times New Roman', Times, serif;
        }

        body {
            background: var(--primary-light);
            color: #333;
            transition: var(--transition);
            line-height: 1.6;
            padding-top: 70px;
        }

        body.dark {
            background: #121212;
            color: #f0f0f0;
        }

        /* Header */
        .main-header {
            background: var(--primary-blue);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--box-shadow);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            flex: 1;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 24px;
        }

        .logo h1 {
            font-size: 20px;
            font-weight: 700;
        }

        /* Search Bar */
        .search-container {
            flex: 1;
            max-width: 500px;
            position: relative;
            margin: 0 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: none;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            color: #333;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }

        .dark .search-input {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .dark .search-input:focus {
            background: rgba(255, 255, 255, 0.15);
        }

        .search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--primary-blue);
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
        }

        .dark .search-btn {
            color: #ccc;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* Mobile Search */
        .mobile-search-container {
            display: none;
            padding: 15px;
            background: var(--primary-blue);
            position: fixed;
            top: 70px;
            left: 0;
            width: 100%;
            z-index: 999;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .mobile-search-input {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            color: #333;
        }

        .dark .mobile-search-input {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Dashboard Container */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border-top: 4px solid var(--primary-blue);
        }

        .dark .summary-card {
            background: #1e1e1e;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.15);
        }

        .summary-card h3 {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .dark .summary-card h3 {
            color: #aaa;
        }

        .summary-card .value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .summary-card .subtext {
            font-size: 13px;
            color: #777;
        }

        .dark .summary-card .subtext {
            color: #aaa;
        }

        /* Departments Grid */
        .departments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .department-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border-left: 4px solid var(--primary-blue);
        }

        .dark .department-card {
            background: #1e1e1e;
        }

        .department-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.15);
        }

        .department-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .department-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .course-count {
            background: var(--primary-blue);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .department-courses {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .course-item {
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: var(--transition);
            border: 1px solid #e9ecef;
        }

        .dark .course-item {
            background: #252525;
            border-color: #444;
        }

        .course-item:hover {
            background: #e9ecef;
            transform: translateX(3px);
            border-color: var(--primary-blue);
        }

        .dark .course-item:hover {
            background: #2d3748;
            border-color: var(--primary-blue);
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .course-code {
            font-weight: 700;
            color: var(--primary-blue);
            font-size: 15px;
        }

        .dark .course-code {
            color: #4dabf7;
        }

        .course-name {
            font-size: 13px;
            color: #666;
            margin: 5px 0;
            line-height: 1.4;
        }

        .dark .course-name {
            color: #aaa;
        }

        /* Enhanced Button Group Styling */
        .course-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
            padding-top: 10px;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
        }

        .dark .course-actions {
            border-top-color: rgba(255, 255, 255, 0.1);
        }

        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-width: 70px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .action-btn:after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, .5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .action-btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 1;
            }
            20% {
                transform: scale(25, 25);
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }

        .action-btn i {
            font-size: 11px;
        }

        /* Button Color Variants */
        .action-btn.add-unit {
            background: linear-gradient(135deg, var(--purple) 0%, #8a63d2 100%);
            color: white;
            border: 1px solid var(--purple);
        }

        .action-btn.add-unit:hover {
            background: linear-gradient(135deg, #5936a8 0%, #7a52c9 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(111, 66, 193, 0.3);
        }

        .action-btn.units {
            background: linear-gradient(135deg, var(--teal) 0%, #36cf9a 100%);
            color: white;
            border: 1px solid var(--teal);
        }

        .action-btn.units:hover {
            background: linear-gradient(135deg, #1ba87e 0%, #2dc395 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(32, 201, 151, 0.3);
        }

        .action-btn.view {
            background: linear-gradient(135deg, var(--primary-blue) 0%, #3395ff 100%);
            color: white;
            border: 1px solid var(--primary-blue);
        }

        .action-btn.view:hover {
            background: linear-gradient(135deg, #0062cc 0%, #2980ff 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }

        .action-btn.edit {
            background: linear-gradient(135deg, var(--warning-orange) 0%, #ffce3a 100%);
            color: #212529;
            border: 1px solid var(--warning-orange);
        }

        .action-btn.edit:hover {
            background: linear-gradient(135deg, #d39e00 0%, #ffc720 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
        }

        .action-btn.delete {
            background: linear-gradient(135deg, var(--danger-red) 0%, #e4606d 100%);
            color: white;
            border: 1px solid var(--danger-red);
        }

        .action-btn.delete:hover {
            background: linear-gradient(135deg, #bd2130 0%, #e05260 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Units Section */
        .units-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }

        .dark .units-section {
            background: #1e1e1e;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-header h2 {
            color: var(--primary-blue);
            font-size: 22px;
        }

        /* Units Table */
        .units-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .units-table th {
            background: var(--primary-blue);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 14px;
            letter-spacing: 0.5px;
        }

        .units-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .dark .units-table td {
            border-bottom-color: #333;
        }

        .units-table tbody tr:hover {
            background: rgba(0, 123, 255, 0.05);
        }

        .dark .units-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .unit-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .unit-type.core {
            background: #d4edda;
            color: #155724;
        }

        .dark .unit-type.core {
            background: #155724;
            color: #d4edda;
        }

        .unit-type.elective {
            background: #cce5ff;
            color: #004085;
        }

        .dark .unit-type.elective {
            background: #004085;
            color: #cce5ff;
        }

        /* Trainers Section */
        .trainers-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
        }

        .dark .trainers-section {
            background: #1e1e1e;
        }

        .trainers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .trainer-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-blue);
            transition: var(--transition);
        }

        .dark .trainer-card {
            background: #252525;
        }

        .trainer-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }

        .trainer-name {
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .trainer-department {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .dark .trainer-department {
            color: #aaa;
        }

        .trainer-units {
            font-size: 11px;
            color: #777;
            margin-top: 8px;
        }

        .dark .trainer-units {
            color: #aaa;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: auto;
            position: relative;
            animation: slideUp 0.4s ease;
        }

        .dark .modal-content {
            background: #1e1e1e;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal h2 {
            color: var(--primary-blue);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .dark .modal h2 {
            border-bottom-color: #333;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            transition: var(--transition);
        }

        .close-btn:hover {
            color: var(--danger-red);
            transform: rotate(90deg);
        }

        /* Form Styling */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .dark .form-group label {
            color: #ccc;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
            background: white;
        }

        .dark .form-group input, .dark .form-group select, .dark .form-group textarea {
            background: #252525;
            border-color: #444;
            color: white;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-green);
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-purple {
            background: var(--purple);
            color: white;
        }

        .btn-purple:hover {
            background: #5936a8;
            transform: translateY(-2px);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .dark .tabs {
            border-bottom-color: #333;
        }

        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .dark .tab-btn {
            color: #aaa;
        }

        .tab-btn.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
        }

        .dark .tab-btn.active {
            color: var(--primary-blue);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Settings Modal */
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .setting-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-blue);
        }

        .dark .setting-item {
            background: #252525;
        }

        .setting-item h4 {
            color: var(--primary-blue);
            margin-bottom: 10px;
        }

        .setting-item p {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }

        .dark .setting-item p {
            color: #aaa;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-blue);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        /* Quick Add Unit Button */
        .quick-add-unit {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--success-green);
            color: white;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            transition: var(--transition);
            z-index: 100;
        }

        .quick-add-unit:hover {
            background: #218838;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        /* Export Button */
        .export-btn {
            background: var(--purple);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .export-btn:hover {
            background: #5936a8;
            transform: translateY(-2px);
        }

        /* Mobile Responsiveness */
        @media (max-width: 992px) {
            .search-container {
                max-width: 300px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding-top: 120px;
            }

            .main-header {
                padding: 15px;
                flex-direction: column;
                gap: 15px;
            }

            .header-content {
                width: 100%;
                justify-content: space-between;
            }

            .logo h1 {
                font-size: 18px;
            }

            .search-container {
                display: none;
            }

            #mobileSearchBtn {
                display: block;
            }

            .dashboard-container {
                padding: 15px;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .departments-grid {
                grid-template-columns: 1fr;
            }

            .department-card {
                padding: 20px;
            }

            .units-section, .trainers-section {
                padding: 20px;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .quick-add-unit {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .tabs {
                flex-direction: column;
                gap: 5px;
            }

            .tab-btn {
                width: 100%;
                text-align: left;
                padding: 8px 15px;
            }

            /* Enhanced Mobile Button Layout */
            .course-actions {
                gap: 6px;
            }

            .action-btn {
                padding: 8px 10px;
                min-width: 65px;
                font-size: 11px;
            }

            .action-btn i {
                font-size: 10px;
            }
        }

        @media (max-width: 480px) {
            .logo h1 {
                font-size: 16px;
            }

            .summary-card {
                padding: 20px;
            }

            .trainers-grid {
                grid-template-columns: 1fr;
            }

            .section-header h2 {
                font-size: 18px;
            }

            .course-actions {
                justify-content: space-between;
            }

            .action-btn {
                flex: 1;
                min-width: 0;
                padding: 8px 6px;
                font-size: 10px;
            }

            .action-btn i {
                display: none;
            }
        }

        /* Responsive Table */
        .responsive-table {
            overflow-x: auto;
            margin-top: 20px;
        }

        /* Mobile search button */
        #mobileSearchBtn {
            display: none;
        }

        @media (max-width: 768px) {
            #mobileSearchBtn {
                display: flex;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success-green);
            color: white;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 3000;
            display: none;
            animation: slideUpToast 0.3s ease;
        }

        @keyframes slideUpToast {
            from { bottom: -50px; opacity: 0; }
            to { bottom: 20px; opacity: 1; }
        }

        .toast.error {
            background: var(--danger-red);
        }

        .toast.warning {
            background: var(--warning-orange);
        }

        /* Unit Details Table */
        .details-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .details-table th {
            background: #f8f9fa;
            color: #333;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            width: 30%;
        }

        .dark .details-table th {
            background: #2d3748;
            color: #f0f0f0;
            border-bottom-color: #4a5568;
        }

        .details-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .dark .details-table td {
            border-bottom-color: #4a5568;
        }

        .details-table tr:last-child th,
        .details-table tr:last-child td {
            border-bottom: none;
        }

        /* Units List Modal */
        .units-list-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .units-list-table {
            width: 100%;
            border-collapse: collapse;
        }

        .units-list-table th {
            background: var(--primary-blue);
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .units-list-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }

        .dark .units-list-table td {
            border-bottom-color: #444;
        }

        .units-list-table tbody tr:hover {
            background: rgba(0, 123, 255, 0.05);
        }

        .dark .units-list-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Show all units in department cards */
        .all-units-container {
            max-height: none;
            overflow: visible;
        }

        .course-units-list {
            max-height: none !important;
            overflow: visible !important;
        }

        /* Inline Edit Form Styling */
        .edit-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            border: 2px solid var(--primary-blue);
        }

        .dark .edit-form {
            background: #252525;
            border-color: var(--primary-blue);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .dark .form-control {
            background: #333;
            border-color: #555;
            color: white;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .dark .form-label {
            color: #ccc;
        }

        /* Mobile Responsive Table Actions */
        @media (max-width: 768px) {
            .units-table th:nth-child(3),
            .units-table td:nth-child(3),
            .units-table th:nth-child(5),
            .units-table td:nth-child(5) {
                display: none;
            }
            
            .units-table .action-buttons {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }
            
            .action-btn {
                width: 100%;
                padding: 8px 10px;
                font-size: 11px;
            }
        }

        @media (max-width: 480px) {
            .units-table th:nth-child(4),
            .units-table td:nth-child(4) {
                display: none;
            }

            .units-table .action-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .units-table .action-btn {
                flex: 1;
                min-width: 0;
                padding: 6px 8px;
                font-size: 10px;
            }
        }

        /* Edit Unit Modal - Responsive */
        .edit-unit-modal .form-row {
            grid-template-columns: 1fr;
        }

        /* Confirm Delete Modal */
        .confirm-modal {
            max-width: 400px;
        }

        .confirm-text {
            text-align: center;
            margin: 20px 0;
            font-size: 16px;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .btn-cancel:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: var(--danger-red);
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        /* Table action buttons */
        .table-actions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        /* Hover effect for course items */
        .course-item:hover .course-actions .action-btn {
            transform: translateY(-1px);
        }

        /* Button icons */
        .btn-icon {
            margin-right: 5px;
        }
    </style>
</head>
<body>

<header class="main-header">
    <div class="header-content">
        <div class="logo">
            <i class="fas fa-university"></i>
            <h1>UCST Course Management</h1>
        </div>
        
        <!-- Desktop Search Bar -->
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search courses, units, trainers...">
            <button class="search-btn" id="searchButton">
                <i class="fas fa-search"></i>
            </button>
        </div>
        
        <div class="header-controls">
            <!-- Mobile Search Button -->
            <button id="mobileSearchBtn" class="header-btn" title="Search">
                <i class="fas fa-search"></i>
            </button>
            <!-- Theme Toggle -->
            <button id="toggleTheme" class="header-btn" title="Toggle theme">ðŸŒ™</button>
            <!-- Settings Button -->
            <button id="settingsBtn" class="header-btn" title="Settings">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </div>
    
    <!-- Mobile Search Container -->
    <div class="mobile-search-container" id="mobileSearchContainer">
        <input type="text" class="mobile-search-input" id="mobileSearchInput" placeholder="Search courses, units, trainers...">
        <button class="search-btn" id="mobileSearchButton">
            <i class="fas fa-search"></i>
        </button>
    </div>
</header>

<!-- Quick Add Unit Button -->
<button class="quick-add-unit" id="quickAddUnit" title="Quick Add Unit">
    <i class="fas fa-plus"></i>
</button>

<!-- Toast Notification -->
<div class="toast" id="toast"></div>

<div class="dashboard-container">
    <!-- Summary Cards -->
    <div class="summary-cards">
        <div class="summary-card">
            <h3>Total Departments</h3>
            <div class="value" id="totalDepartments">0</div>
            <div class="subtext">Academic departments</div>
        </div>
        <div class="summary-card">
            <h3>Total Courses</h3>
            <div class="value" id="totalCourses">0</div>
            <div class="subtext">Diploma & Certificate programs</div>
        </div>
        <div class="summary-card">
            <h3>Total Units</h3>
            <div class="value" id="totalUnits">0</div>
            <div class="subtext">Course modules/subjects</div>
        </div>
        <div class="summary-card">
            <h3>Active Trainers</h3>
            <div class="value" id="totalTrainers">0</div>
            <div class="subtext">Teaching staff</div>
        </div>
    </div>

    <!-- Tabs for different views -->
    <div class="tabs">
        <button class="tab-btn active" data-tab="departments">Departments & Courses</button>
        <button class="tab-btn" data-tab="units">Units Management</button>
        <button class="tab-btn" data-tab="trainers">Trainers Allocation</button>
        <button class="tab-btn" data-tab="classes">Class Scheduling</button>
    </div>

    <!-- Departments & Courses Tab -->
    <div id="departments" class="tab-content active">
        <div class="section-header">
            <h2><i class="fas fa-building"></i> Departments & Courses</h2>
            <button class="btn btn-primary" onclick="openAddCourseModal()">
                <i class="fas fa-plus"></i> Add New Course
            </button>
        </div>

        <div class="departments-grid" id="departmentsContainer">
            <div class="spinner" id="departmentsSpinner"></div>
        </div>
    </div>

    <!-- Units Management Tab -->
    <div id="units" class="tab-content">
        <div class="units-section">
            <div class="section-header">
                <h2><i class="fas fa-book"></i> Units Management</h2>
                <div>
                    <button class="export-btn" onclick="exportUnits()">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button class="btn btn-success" onclick="openAddUnitModal()" style="margin-left: 10px;">
                        <i class="fas fa-plus"></i> Add New Unit
                    </button>
                </div>
            </div>

            <div class="responsive-table">
                <table class="units-table">
                    <thead>
                        <tr>
                            <th>Unit Code</th>
                            <th>Unit Name</th>
                            <th>Course</th>
                            <th>Type</th>
                            <th>Credits</th>
                            <th>Semester</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="unitsTableBody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px;">
                                <div class="spinner" id="unitsSpinner"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Trainers Allocation Tab -->
    <div id="trainers" class="tab-content">
        <div class="trainers-section">
            <div class="section-header">
                <h2><i class="fas fa-chalkboard-teacher"></i> Trainers Allocation</h2>
                <button class="btn btn-primary" onclick="openAddTrainerModal()">
                    <i class="fas fa-plus"></i> Add Trainer
                </button>
            </div>

            <div class="trainers-grid" id="trainersContainer">
                <div class="spinner" id="trainersSpinner"></div>
            </div>
        </div>
    </div>

    <!-- Class Scheduling Tab -->
    <div id="classes" class="tab-content">
        <div class="units-section">
            <div class="section-header">
                <h2><i class="fas fa-calendar-alt"></i> Class Scheduling</h2>
                <button class="btn btn-success" onclick="openAddScheduleModal()">
                    <i class="fas fa-plus"></i> Schedule Class
                </button>
            </div>

            <div class="responsive-table">
                <table class="units-table">
                    <thead>
                        <tr>
                            <th>Unit</th>
                            <th>Trainer</th>
                            <th>Day</th>
                            <th>Time</th>
                            <th>Venue</th>
                            <th>Class Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTableBody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px;">
                                <div class="spinner" id="scheduleSpinner"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Add Course Modal -->
<div class="modal" id="addCourseModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeAddCourseModal()">Ã—</span>
        <h2><i class="fas fa-book"></i> Add New Course</h2>
        <form id="courseForm" onsubmit="addNewCourse(event)">
            <div class="form-group">
                <label for="courseCode">Course Code *</label>
                <input type="text" id="courseCode" required placeholder="e.g., DCS201">
            </div>
            <div class="form-group">
                <label for="courseName">Course Name *</label>
                <input type="text" id="courseName" required placeholder="e.g., Diploma in Computer Science">
            </div>
            <div class="form-group">
                <label for="courseDepartment">Department *</label>
                <select id="courseDepartment" required>
                    <option value="">Select Department</option>
                    <option value="Computing & Informatics">Computing & Informatics</option>
                    <option value="Business & Entrepreneurship">Business & Entrepreneurship</option>
                    <option value="Mechanical & Automotive Engineering">Mechanical & Automotive Engineering</option>
                    <option value="Electrical & Electronics Engineering">Electrical & Electronics Engineering</option>
                    <option value="Applied Sciences & Mathematics">Applied Sciences & Mathematics</option>
                    <option value="Agriculture & Environmental Studies">Agriculture & Environmental Studies</option>
                    <option value="Hospitality & Institutional Management">Hospitality & Institutional Management</option>
                    <option value="Fashion & Design">Fashion & Design</option>
                </select>
            </div>
            <div class="form-group">
                <label for="courseLevel">Course Level *</label>
                <select id="courseLevel" required>
                    <option value="">Select Level</option>
                    <option value="Diploma">Diploma (3 Years)</option>
                    <option value="Certificate">Certificate (2 Years)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="courseFee">Course Fee per Semester (KES) *</label>
                <input type="number" id="courseFee" required min="0" step="1000" placeholder="e.g., 35000">
            </div>
            <div class="form-group">
                <label for="examBody">Exam Body *</label>
                <select id="examBody" required>
                    <option value="">Select Exam Body</option>
                    <option value="KNEC">KNEC</option>
                    <option value="CDACC">CDACC</option>
                    <option value="NITA">NITA</option>
                </select>
            </div>
            <div class="form-group">
                <label for="courseDescription">Course Description</label>
                <textarea id="courseDescription" rows="3" placeholder="Brief description of the course"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeAddCourseModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Course</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Unit Modal -->
<div class="modal" id="addUnitModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeAddUnitModal()">Ã—</span>
        <h2><i class="fas fa-book-open"></i> Add New Unit</h2>
        <form id="unitForm" onsubmit="addNewUnit(event)">
            <div class="form-group">
                <label for="unitCode">Unit Code *</label>
                <input type="text" id="unitCode" required placeholder="e.g., DCS101">
            </div>
            <div class="form-group">
                <label for="unitName">Unit Name *</label>
                <input type="text" id="unitName" required placeholder="e.g., Introduction to Programming">
            </div>
            <div class="form-group">
                <label for="unitCourse">Course *</label>
                <select id="unitCourse" required onchange="updateSemesterOptions()">
                    <option value="">Select Course</option>
                </select>
            </div>
            <div class="form-group">
                <label for="unitSemester">Semester *</label>
                <select id="unitSemester" required>
                    <option value="">Select Semester</option>
                </select>
            </div>
            <div class="form-group">
                <label for="unitType">Unit Type *</label>
                <select id="unitType" required>
                    <option value="">Select Type</option>
                    <option value="core">Core</option>
                    <option value="elective">Elective</option>
                </select>
            </div>
            <div class="form-group">
                <label for="unitCredits">Credit Hours *</label>
                <input type="number" id="unitCredits" required min="1" max="10" placeholder="e.g., 3">
            </div>
            <div class="form-group">
                <label for="unitDescription">Unit Description</label>
                <textarea id="unitDescription" rows="3" placeholder="Brief description of the unit"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeAddUnitModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Unit</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Unit Modal -->
<div class="modal" id="editUnitModal">
    <div class="modal-content edit-unit-modal">
        <span class="close-btn" onclick="closeEditUnitModal()">Ã—</span>
        <h2><i class="fas fa-edit"></i> Edit Unit</h2>
        <form id="editUnitForm" onsubmit="updateUnit(event)">
            <input type="hidden" id="editUnitKey">
            <div class="form-row">
                <div class="form-group">
                    <label for="editUnitCode">Unit Code *</label>
                    <input type="text" id="editUnitCode" required class="form-control" placeholder="e.g., DCS101">
                </div>
                <div class="form-group">
                    <label for="editUnitName">Unit Name *</label>
                    <input type="text" id="editUnitName" required class="form-control" placeholder="e.g., Introduction to Programming">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="editUnitCourse">Course *</label>
                    <select id="editUnitCourse" required class="form-control" onchange="updateEditSemesterOptions()">
                        <option value="">Select Course</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editUnitSemester">Semester *</label>
                    <select id="editUnitSemester" required class="form-control">
                        <option value="">Select Semester</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="editUnitType">Unit Type *</label>
                    <select id="editUnitType" required class="form-control">
                        <option value="">Select Type</option>
                        <option value="core">Core</option>
                        <option value="elective">Elective</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editUnitCredits">Credit Hours *</label>
                    <input type="number" id="editUnitCredits" required min="1" max="10" class="form-control" placeholder="e.g., 3">
                </div>
            </div>
            <div class="form-group">
                <label for="editUnitDescription">Unit Description</label>
                <textarea id="editUnitDescription" rows="3" class="form-control" placeholder="Brief description of the unit"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeEditUnitModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Update Unit</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Trainer Modal -->
<div class="modal" id="addTrainerModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeAddTrainerModal()">Ã—</span>
        <h2><i class="fas fa-user-tie"></i> Add New Trainer</h2>
        <form id="trainerForm" onsubmit="addNewTrainer(event)">
            <div class="form-group">
                <label for="trainerName">Full Name *</label>
                <input type="text" id="trainerName" required placeholder="e.g., John Doe">
            </div>
            <div class="form-group">
                <label for="trainerDepartment">Department *</label>
                <select id="trainerDepartment" required>
                    <option value="">Select Department</option>
                    <option value="Computing & Informatics">Computing & Informatics</option>
                    <option value="Business & Entrepreneurship">Business & Entrepreneurship</option>
                    <option value="Mechanical & Automotive Engineering">Mechanical & Automotive Engineering</option>
                    <option value="Electrical & Electronics Engineering">Electrical & Electronics Engineering</option>
                    <option value="Applied Sciences & Mathematics">Applied Sciences & Mathematics</option>
                    <option value="Agriculture & Environmental Studies">Agriculture & Environmental Studies</option>
                    <option value="Hospitality & Institutional Management">Hospitality & Institutional Management</option>
                    <option value="Fashion & Design">Fashion & Design</option>
                </select>
            </div>
            <div class="form-group">
                <label for="trainerSpecialization">Specialization</label>
                <input type="text" id="trainerSpecialization" placeholder="e.g., Software Development">
            </div>
            <div class="form-group">
                <label for="trainerEmail">Email Address *</label>
                <input type="email" id="trainerEmail" required placeholder="e.g., trainer@ucst.ac.ke">
            </div>
            <div class="form-group">
                <label for="trainerPhone">Phone Number</label>
                <input type="text" id="trainerPhone" placeholder="e.g., +254 712 345 678">
            </div>
            <div class="form-group">
                <label for="trainerQualifications">Qualifications</label>
                <textarea id="trainerQualifications" rows="3" placeholder="Academic and professional qualifications"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeAddTrainerModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Trainer</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Schedule Modal -->
<div class="modal" id="addScheduleModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeAddScheduleModal()">Ã—</span>
        <h2><i class="fas fa-calendar-plus"></i> Schedule Class</h2>
        <form id="scheduleForm" onsubmit="addNewSchedule(event)">
            <div class="form-group">
                <label for="scheduleUnit">Unit *</label>
                <select id="scheduleUnit" required>
                    <option value="">Select Unit</option>
                </select>
            </div>
            <div class="form-group">
                <label for="scheduleTrainer">Trainer *</label>
                <select id="scheduleTrainer" required>
                    <option value="">Select Trainer</option>
                </select>
            </div>
            <div class="form-group">
                <label for="scheduleDay">Day of Week *</label>
                <select id="scheduleDay" required>
                    <option value="">Select Day</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                </select>
            </div>
            <div class="form-group">
                <label for="scheduleTime">Time Slot *</label>
                <select id="scheduleTime" required>
                    <option value="">Select Time</option>
                    <option value="8:00 AM - 10:00 AM">8:00 AM - 10:00 AM</option>
                    <option value="10:00 AM - 12:00 PM">10:00 AM - 12:00 PM</option>
                    <option value="12:00 PM - 2:00 PM">12:00 PM - 2:00 PM</option>
                    <option value="2:00 PM - 4:00 PM">2:00 PM - 4:00 PM</option>
                    <option value="4:00 PM - 6:00 PM">4:00 PM - 6:00 PM</option>
                </select>
            </div>
            <div class="form-group">
                <label for="scheduleVenue">Venue/Room *</label>
                <input type="text" id="scheduleVenue" required placeholder="e.g., Room 101">
            </div>
            <div class="form-group">
                <label for="scheduleType">Class Type *</label>
                <select id="scheduleType" required>
                    <option value="">Select Type</option>
                    <option value="Lecture">Lecture</option>
                    <option value="Tutorial">Tutorial</option>
                    <option value="Practical">Practical</option>
                </select>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeAddScheduleModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Schedule Class</button>
            </div>
        </form>
    </div>
</div>

<!-- View Units Modal -->
<div class="modal" id="viewUnitsModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeViewUnitsModal()">Ã—</span>
        <h2><i class="fas fa-book"></i> Course Units</h2>
        <div id="viewUnitsTitle" style="margin-bottom: 20px; font-size: 18px; color: var(--primary-blue);"></div>
        <div class="units-list-container" id="unitsListContainer">
            <table class="units-list-table">
                <thead>
                    <tr>
                        <th>Unit Code</th>
                        <th>Unit Name</th>
                        <th>Type</th>
                        <th>Credits</th>
                        <th>Semester</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="unitsListBody">
                    <!-- Units will be populated here -->
                </tbody>
            </table>
        </div>
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeViewUnitsModal()">Close</button>
        </div>
    </div>
</div>

<!-- View Unit Details Modal -->
<div class="modal" id="viewUnitModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeViewUnitModal()">Ã—</span>
        <h2><i class="fas fa-book-open"></i> Unit Details</h2>
        <div id="viewUnitTitle" style="margin-bottom: 20px; font-size: 18px; color: var(--primary-blue);"></div>
        <table class="details-table" id="unitDetailsTable">
            <!-- Unit details will be populated here -->
        </table>
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeViewUnitModal()">Close</button>
        </div>
    </div>
</div>

<!-- Confirm Delete Modal -->
<div class="modal" id="confirmDeleteModal">
    <div class="modal-content confirm-modal">
        <span class="close-btn" onclick="closeConfirmDeleteModal()">Ã—</span>
        <h2><i class="fas fa-exclamation-triangle"></i> Confirm Delete</h2>
        <div class="confirm-text" id="confirmDeleteText">
            Are you sure you want to delete this unit? This action cannot be undone.
        </div>
        <input type="hidden" id="deleteUnitKey">
        <input type="hidden" id="deleteUnitCode">
        <div class="confirm-buttons">
            <button type="button" class="btn btn-cancel" onclick="closeConfirmDeleteModal()">Cancel</button>
            <button type="button" class="btn btn-danger" onclick="confirmDeleteUnit()">Delete</button>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div class="modal" id="settingsModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeSettingsModal()">Ã—</span>
        <h2><i class="fas fa-cog"></i> System Settings</h2>
        
        <div class="settings-grid">
            <div class="setting-item">
                <h4>Notifications</h4>
                <p>Receive email notifications for new courses and units</p>
                <label class="switch">
                    <input type="checkbox" id="notificationsToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-item">
                <h4>Auto-save</h4>
                <p>Automatically save changes every 5 minutes</p>
                <label class="switch">
                    <input type="checkbox" id="autosaveToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-item">
                <h4>Dark Mode</h4>
                <p>Toggle dark/light theme</p>
                <label class="switch">
                    <input type="checkbox" id="darkModeToggle">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-item">
                <h4>Data Export</h4>
                <p>Allow export of course data to CSV</p>
                <label class="switch">
                    <input type="checkbox" id="exportToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeSettingsModal()">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
        </div>
    </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// Firebase Configuration
const firebaseConfig = {
    apiKey: "AIzaSyAQZ1_Grh00sFgOp8pxkKff10sMFSw9xlc",
    authDomain: "jnnp-system.firebaseapp.com",
    databaseURL: "https://jnnp-system-default-rtdb.firebaseio.com",
    projectId: "jnnp-system",
    storageBucket: "jnnp-system.firebasestorage.app",
    messagingSenderId: "769232855377",
    appId: "1:769232855377:web:e3ba51e3e25cc24735f370"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Global variables
let courses = {};
let units = {};
let trainers = {};
let schedules = {};

// UCST Departments
const UCST_DEPARTMENTS = [
    "Mechanical & Automotive Engineering",
    "Business & Entrepreneurship", 
    "Electrical & Electronics Engineering",
    "Applied Sciences & Mathematics",
    "Agriculture & Environmental Studies",
    "Hospitality & Institutional Management",
    "Computing & Informatics",
    "Fashion & Design"
];

// Load data from Firebase
function loadData() {
    // Load courses
    db.ref("courses").on("value", snap => {
        courses = snap.val() || {};
        updateSummaryCards();
        renderDepartments();
        populateCourseDropdowns();
        populateEditCourseDropdowns();
    });

    // Load units
    db.ref("units").on("value", snap => {
        units = snap.val() || {};
        updateSummaryCards();
        renderUnitsTable();
    });

    // Load trainers
    db.ref("trainers").on("value", snap => {
        trainers = snap.val() || {};
        updateSummaryCards();
        renderTrainers();
        populateTrainerDropdown();
    });

    // Load schedules
    db.ref("schedules").on("value", snap => {
        schedules = snap.val() || {};
        renderScheduleTable();
    });
}

// Update summary cards
function updateSummaryCards() {
    const totalDepartments = UCST_DEPARTMENTS.length;
    const totalCourses = Object.keys(courses).length;
    const totalUnits = Object.keys(units).length;
    const totalTrainers = Object.keys(trainers).length;

    document.getElementById('totalDepartments').textContent = totalDepartments;
    document.getElementById('totalCourses').textContent = totalCourses;
    document.getElementById('totalUnits').textContent = totalUnits;
    document.getElementById('totalTrainers').textContent = totalTrainers;
}

// Render departments with their courses
function renderDepartments() {
    const container = document.getElementById('departmentsContainer');
    const spinner = document.getElementById('departmentsSpinner');
    
    if (spinner) spinner.style.display = 'none';
    
    if (Object.keys(courses).length === 0) {
        container.innerHTML = `
            <div style="color: #999; text-align: center; padding: 40px; width: 100%;">
                <i class="fas fa-book" style="font-size: 48px; margin-bottom: 20px; color: #ccc;"></i>
                <h3>No courses added yet</h3>
                <p>Click "Add New Course" to get started</p>
            </div>`;
        return;
    }

    // Group courses by department
    const coursesByDepartment = {};
    UCST_DEPARTMENTS.forEach(dept => {
        coursesByDepartment[dept] = [];
    });

    Object.values(courses).forEach(course => {
        if (course.courseDepartment && coursesByDepartment[course.courseDepartment]) {
            coursesByDepartment[course.courseDepartment].push(course);
        }
    });

    // Create department cards
    container.innerHTML = '';
    UCST_DEPARTMENTS.forEach(dept => {
        const deptCourses = coursesByDepartment[dept] || [];
        
        const departmentCard = document.createElement('div');
        departmentCard.className = 'department-card';
        departmentCard.innerHTML = `
            <div class="department-header">
                <div class="department-name">${dept}</div>
                <div class="course-count">${deptCourses.length} courses</div>
            </div>
            <div class="department-courses">
                ${deptCourses.length > 0 ? 
                    deptCourses.map(course => `
                        <div class="course-item">
                            <div class="course-header">
                                <div class="course-code">${course.courseCode || ''}</div>
                            </div>
                            <div class="course-name">${course.courseName || ''}</div>
                            <div class="course-actions">
                                <button class="action-btn add-unit" onclick="quickAddUnitForCourse('${course.courseCode}')" title="Add Unit">
                                    <i class="fas fa-plus-circle"></i> Add Unit
                                </button>
                                <button class="action-btn units" onclick="viewUnits('${course.courseCode}')" title="View Units">
                                    <i class="fas fa-book"></i> Units
                                </button>
                                <button class="action-btn view" onclick="viewCourse('${course.courseCode}')" title="View Details">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="action-btn edit" onclick="editCourse('${course.courseCode}')" title="Edit Course">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="action-btn delete" onclick="deleteCourse('${course.courseCode}')" title="Delete Course">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    `).join('') : 
                    '<div style="color: #999; text-align: center; padding: 10px;">No courses added yet</div>'
                }
            </div>
        `;
        
        container.appendChild(departmentCard);
    });
}

// Render units table with edit and delete buttons
function renderUnitsTable() {
    const tbody = document.getElementById('unitsTableBody');
    const spinner = document.getElementById('unitsSpinner');
    
    if (spinner) spinner.style.display = 'none';
    
    if (Object.keys(units).length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" style="text-align: center; padding: 40px;">
                    <i class="fas fa-book-open" style="font-size: 48px; margin-bottom: 20px; color: #ccc;"></i>
                    <h3>No units added yet</h3>
                    <p>Click "Add New Unit" to get started</p>
                </td>
            </tr>`;
        return;
    }

    tbody.innerHTML = '';
    
    Object.keys(units).forEach(unitKey => {
        const unit = units[unitKey];
        const course = Object.values(courses).find(c => c.courseCode === unit.courseCode);
        const courseName = course ? course.courseName : 'Unknown Course';
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><strong>${unit.unitCode}</strong></td>
            <td>${unit.unitName}</td>
            <td>${courseName}</td>
            <td><span class="unit-type ${unit.unitType || 'core'}">${unit.unitType || 'core'}</span></td>
            <td>${unit.unitCredits || 'N/A'}</td>
            <td>${unit.unitSemester || 'N/A'}</td>
            <td>
                <div class="table-actions">
                    <button class="action-btn view" onclick="viewUnit('${unit.unitCode}')" title="View Details">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="action-btn edit" onclick="editUnitInTable('${unitKey}', '${unit.unitCode}')" title="Edit Unit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete" onclick="deleteUnit('${unitKey}', '${unit.unitCode}')" title="Delete Unit">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// Render trainers
function renderTrainers() {
    const container = document.getElementById('trainersContainer');
    const spinner = document.getElementById('trainersSpinner');
    
    if (spinner) spinner.style.display = 'none';
    
    if (Object.keys(trainers).length === 0) {
        container.innerHTML = `
            <div style="color: #999; text-align: center; padding: 40px; width: 100%;">
                <i class="fas fa-chalkboard-teacher" style="font-size: 48px; margin-bottom: 20px; color: #ccc;"></i>
                <h3>No trainers added yet</h3>
                <p>Click "Add Trainer" to get started</p>
            </div>`;
        return;
    }

    container.innerHTML = '';
    
    Object.values(trainers).forEach(trainer => {
        // Count units assigned to this trainer
        const assignedUnits = Object.values(units).filter(unit => 
            unit.assignedTrainer === trainer.trainerId
        ).length;
        
        const trainerCard = document.createElement('div');
        trainerCard.className = 'trainer-card';
        trainerCard.innerHTML = `
            <div class="trainer-name">${trainer.trainerName}</div>
            <div class="trainer-department">${trainer.trainerDepartment}</div>
            <div class="trainer-units">Assigned Units: ${assignedUnits}</div>
            <div class="course-actions" style="margin-top: 10px;">
                <button class="action-btn view" onclick="viewTrainerDetails('${trainer.trainerId}')">View</button>
                <button class="action-btn edit" onclick="editTrainer('${trainer.trainerId}')">Edit</button>
            </div>
        `;
        
        container.appendChild(trainerCard);
    });
}

// Render schedule table
function renderScheduleTable() {
    const tbody = document.getElementById('scheduleTableBody');
    const spinner = document.getElementById('scheduleSpinner');
    
    if (spinner) spinner.style.display = 'none';
    
    if (Object.keys(schedules).length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" style="text-align: center; padding: 40px;">
                    <i class="fas fa-calendar-alt" style="font-size: 48px; margin-bottom: 20px; color: #ccc;"></i>
                    <h3>No classes scheduled yet</h3>
                    <p>Click "Schedule Class" to get started</p>
                </td>
            </tr>`;
        return;
    }

    tbody.innerHTML = '';
    
    Object.values(schedules).forEach(schedule => {
        const unit = Object.values(units).find(u => u.unitCode === schedule.unitCode);
        const trainer = Object.values(trainers).find(t => t.trainerId === schedule.trainerId);
        
        const unitName = unit ? unit.unitName : 'Unknown Unit';
        const trainerName = trainer ? trainer.trainerName : 'Unknown Trainer';
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${unitName}</td>
            <td>${trainerName}</td>
            <td>${schedule.scheduleDay}</td>
            <td>${schedule.scheduleTime}</td>
            <td>${schedule.scheduleVenue}</td>
            <td>${schedule.scheduleType}</td>
            <td>
                <div class="table-actions">
                    <button class="action-btn view" onclick="viewSchedule('${schedule.scheduleId}')">View</button>
                    <button class="action-btn edit" onclick="editSchedule('${schedule.scheduleId}')">Edit</button>
                </div>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// Populate dropdowns
function populateCourseDropdowns() {
    const courseSelect = document.getElementById('unitCourse');
    const scheduleUnitSelect = document.getElementById('scheduleUnit');
    
    // Clear existing options except first
    while (courseSelect.options.length > 1) courseSelect.remove(1);
    while (scheduleUnitSelect.options.length > 1) scheduleUnitSelect.remove(1);
    
    // Add courses to dropdowns
    Object.values(courses).forEach(course => {
        const option1 = document.createElement('option');
        option1.value = course.courseCode;
        option1.textContent = `${course.courseCode} - ${course.courseName}`;
        courseSelect.appendChild(option1);
        
        const option2 = document.createElement('option');
        option2.value = course.courseCode;
        option2.textContent = `${course.courseCode} - ${course.courseName}`;
        scheduleUnitSelect.appendChild(option2);
    });
}

function populateEditCourseDropdowns() {
    const courseSelect = document.getElementById('editUnitCourse');
    
    // Clear existing options except first
    while (courseSelect.options.length > 1) courseSelect.remove(1);
    
    // Add courses to dropdown
    Object.values(courses).forEach(course => {
        const option = document.createElement('option');
        option.value = course.courseCode;
        option.textContent = `${course.courseCode} - ${course.courseName}`;
        courseSelect.appendChild(option);
    });
}

function populateTrainerDropdown() {
    const trainerSelect = document.getElementById('scheduleTrainer');
    
    // Clear existing options except first
    while (trainerSelect.options.length > 1) trainerSelect.remove(1);
    
    // Add trainers to dropdown
    Object.values(trainers).forEach(trainer => {
        const option = document.createElement('option');
        option.value = trainer.trainerId;
        option.textContent = `${trainer.trainerName} - ${trainer.trainerDepartment}`;
        trainerSelect.appendChild(option);
    });
}

// Update semester options based on course level
function updateSemesterOptions() {
    const courseCode = document.getElementById('unitCourse').value;
    const course = Object.values(courses).find(c => c.courseCode === courseCode);
    const semesterSelect = document.getElementById('unitSemester');
    
    // Clear existing options
    semesterSelect.innerHTML = '<option value="">Select Semester</option>';
    
    if (course) {
        const totalSemesters = course.courseLevel === 'Diploma' ? 6 : 4;
        
        for (let i = 1; i <= totalSemesters; i++) {
            const option = document.createElement('option');
            option.value = `Semester ${i}`;
            option.textContent = `Semester ${i}`;
            semesterSelect.appendChild(option);
        }
    }
}

function updateEditSemesterOptions() {
    const courseCode = document.getElementById('editUnitCourse').value;
    const course = Object.values(courses).find(c => c.courseCode === courseCode);
    const semesterSelect = document.getElementById('editUnitSemester');
    
    // Clear existing options
    semesterSelect.innerHTML = '<option value="">Select Semester</option>';
    
    if (course) {
        const totalSemesters = course.courseLevel === 'Diploma' ? 6 : 4;
        
        for (let i = 1; i <= totalSemesters; i++) {
            const option = document.createElement('option');
            option.value = `Semester ${i}`;
            option.textContent = `Semester ${i}`;
            semesterSelect.appendChild(option);
        }
    }
}

// Show toast notification
function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = `toast ${type}`;
    toast.style.display = 'block';
    
    setTimeout(() => {
        toast.style.display = 'none';
    }, 3000);
}

// ========== MODAL FUNCTIONS ==========
function openAddCourseModal() {
    document.getElementById('addCourseModal').style.display = 'flex';
    document.getElementById('courseCode').focus();
}

function closeAddCourseModal() {
    document.getElementById('addCourseModal').style.display = 'none';
    document.getElementById('courseForm').reset();
}

function openAddUnitModal() {
    document.getElementById('addUnitModal').style.display = 'flex';
    document.getElementById('unitCode').focus();
}

function closeAddUnitModal() {
    document.getElementById('addUnitModal').style.display = 'none';
    document.getElementById('unitForm').reset();
}

function openEditUnitModal() {
    document.getElementById('editUnitModal').style.display = 'flex';
}

function closeEditUnitModal() {
    document.getElementById('editUnitModal').style.display = 'none';
    document.getElementById('editUnitForm').reset();
}

function openAddTrainerModal() {
    document.getElementById('addTrainerModal').style.display = 'flex';
    document.getElementById('trainerName').focus();
}

function closeAddTrainerModal() {
    document.getElementById('addTrainerModal').style.display = 'none';
    document.getElementById('trainerForm').reset();
}

function openAddScheduleModal() {
    document.getElementById('addScheduleModal').style.display = 'flex';
}

function closeAddScheduleModal() {
    document.getElementById('addScheduleModal').style.display = 'none';
    document.getElementById('scheduleForm').reset();
}

function openViewUnitsModal() {
    document.getElementById('viewUnitsModal').style.display = 'flex';
}

function closeViewUnitsModal() {
    document.getElementById('viewUnitsModal').style.display = 'none';
}

function openViewUnitModal() {
    document.getElementById('viewUnitModal').style.display = 'flex';
}

function closeViewUnitModal() {
    document.getElementById('viewUnitModal').style.display = 'none';
}

function openConfirmDeleteModal() {
    document.getElementById('confirmDeleteModal').style.display = 'flex';
}

function closeConfirmDeleteModal() {
    document.getElementById('confirmDeleteModal').style.display = 'none';
}

function openSettingsModal() {
    document.getElementById('settingsModal').style.display = 'flex';
    
    // Load current settings
    const settings = JSON.parse(localStorage.getItem('ucst_settings') || '{}');
    document.getElementById('notificationsToggle').checked = settings.notifications !== false;
    document.getElementById('autosaveToggle').checked = settings.autosave !== false;
    document.getElementById('darkModeToggle').checked = settings.darkMode === true;
    document.getElementById('exportToggle').checked = settings.exportEnabled !== false;
}

function closeSettingsModal() {
    document.getElementById('settingsModal').style.display = 'none';
}

// ========== FORM SUBMISSION FUNCTIONS ==========
function addNewCourse(event) {
    event.preventDefault();
    
    const courseCode = document.getElementById('courseCode').value.trim();
    const courseName = document.getElementById('courseName').value.trim();
    const courseDepartment = document.getElementById('courseDepartment').value;
    const courseLevel = document.getElementById('courseLevel').value;
    const courseFee = parseFloat(document.getElementById('courseFee').value);
    const examBody = document.getElementById('examBody').value;
    const courseDescription = document.getElementById('courseDescription').value.trim();
    
    if (!courseCode || !courseName || !courseDepartment || !courseLevel || !courseFee || !examBody) {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    const courseData = {
        courseCode,
        courseName,
        courseDepartment,
        courseLevel,
        courseFee,
        examBody,
        courseDescription,
        timestamp: Date.now()
    };
    
    // Check if course already exists
    const existingCourse = Object.values(courses).find(c => c.courseCode === courseCode);
    
    if (existingCourse) {
        if (confirm('Course with this code already exists. Update existing course?')) {
            // Find the key of existing course
            const courseKey = Object.keys(courses).find(key => courses[key].courseCode === courseCode);
            db.ref(`courses/${courseKey}`).update(courseData)
                .then(() => {
                    showToast('Course updated successfully!');
                    closeAddCourseModal();
                })
                .catch(error => {
                    console.error('Error updating course:', error);
                    showToast('Error updating course. Please try again.', 'error');
                });
        }
    } else {
        // Add new course
        const newCourseRef = db.ref('courses').push();
        newCourseRef.set(courseData)
            .then(() => {
                showToast('Course added successfully!');
                closeAddCourseModal();
            })
            .catch(error => {
                console.error('Error adding course:', error);
                showToast('Error adding course. Please try again.', 'error');
            });
    }
}

function addNewUnit(event) {
    event.preventDefault();
    
    const unitCode = document.getElementById('unitCode').value.trim();
    const unitName = document.getElementById('unitName').value.trim();
    const courseCode = document.getElementById('unitCourse').value;
    const unitSemester = document.getElementById('unitSemester').value;
    const unitType = document.getElementById('unitType').value;
    const unitCredits = parseInt(document.getElementById('unitCredits').value);
    const unitDescription = document.getElementById('unitDescription').value.trim();
    
    if (!unitCode || !unitName || !courseCode || !unitSemester || !unitType || !unitCredits) {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    // Check if unit already exists
    const existingUnit = Object.values(units).find(u => u.unitCode === unitCode);
    if (existingUnit) {
        showToast('Unit with this code already exists!', 'error');
        return;
    }
    
    const unitData = {
        unitCode,
        unitName,
        courseCode,
        unitSemester,
        unitType,
        unitCredits,
        unitDescription,
        timestamp: Date.now()
    };
    
    const newUnitRef = db.ref('units').push();
    newUnitRef.set(unitData)
        .then(() => {
            showToast('Unit added successfully!');
            closeAddUnitModal();
        })
        .catch(error => {
            console.error('Error adding unit:', error);
            showToast('Error adding unit. Please try again.', 'error');
        });
}

function addNewTrainer(event) {
    event.preventDefault();
    
    const trainerName = document.getElementById('trainerName').value.trim();
    const trainerDepartment = document.getElementById('trainerDepartment').value;
    const trainerSpecialization = document.getElementById('trainerSpecialization').value.trim();
    const trainerEmail = document.getElementById('trainerEmail').value.trim();
    const trainerPhone = document.getElementById('trainerPhone').value.trim();
    const trainerQualifications = document.getElementById('trainerQualifications').value.trim();
    
    if (!trainerName || !trainerDepartment || !trainerEmail) {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    const trainerId = 'TRN' + Date.now().toString().slice(-6);
    
    const trainerData = {
        trainerId,
        trainerName,
        trainerDepartment,
        trainerSpecialization,
        trainerEmail,
        trainerPhone,
        trainerQualifications,
        status: 'Active',
        timestamp: Date.now()
    };
    
    const newTrainerRef = db.ref('trainers').push();
    newTrainerRef.set(trainerData)
        .then(() => {
            showToast('Trainer added successfully!');
            closeAddTrainerModal();
        })
        .catch(error => {
            console.error('Error adding trainer:', error);
            showToast('Error adding trainer. Please try again.', 'error');
        });
}

function addNewSchedule(event) {
    event.preventDefault();
    
    const unitCode = document.getElementById('scheduleUnit').value;
    const trainerId = document.getElementById('scheduleTrainer').value;
    const scheduleDay = document.getElementById('scheduleDay').value;
    const scheduleTime = document.getElementById('scheduleTime').value;
    const scheduleVenue = document.getElementById('scheduleVenue').value.trim();
    const scheduleType = document.getElementById('scheduleType').value;
    
    if (!unitCode || !trainerId || !scheduleDay || !scheduleTime || !scheduleVenue || !scheduleType) {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    // Check for schedule conflicts
    const hasConflict = Object.values(schedules).some(schedule => 
        schedule.scheduleDay === scheduleDay && 
        schedule.scheduleTime === scheduleTime && 
        (schedule.scheduleVenue === scheduleVenue || schedule.trainerId === trainerId)
    );
    
    if (hasConflict) {
        if (!confirm('Schedule conflict detected! A trainer or venue is already booked for this time. Do you want to proceed anyway?')) {
            return;
        }
    }
    
    const scheduleId = 'SCH' + Date.now().toString().slice(-6);
    
    const scheduleData = {
        scheduleId,
        unitCode,
        trainerId,
        scheduleDay,
        scheduleTime,
        scheduleVenue,
        scheduleType,
        timestamp: Date.now()
    };
    
    const newScheduleRef = db.ref('schedules').push();
    newScheduleRef.set(scheduleData)
        .then(() => {
            showToast('Class scheduled successfully!');
            closeAddScheduleModal();
        })
        .catch(error => {
            console.error('Error scheduling class:', error);
            showToast('Error scheduling class. Please try again.', 'error');
        });
}

// ========== EDIT UNIT FUNCTIONS ==========
function editUnitInTable(unitKey, unitCode) {
    const unit = units[unitKey];
    if (!unit) {
        showToast('Unit not found!', 'error');
        return;
    }
    
    // Populate edit form
    document.getElementById('editUnitKey').value = unitKey;
    document.getElementById('editUnitCode').value = unit.unitCode;
    document.getElementById('editUnitName').value = unit.unitName;
    document.getElementById('editUnitCourse').value = unit.courseCode;
    document.getElementById('editUnitSemester').value = unit.unitSemester;
    document.getElementById('editUnitType').value = unit.unitType;
    document.getElementById('editUnitCredits').value = unit.unitCredits;
    document.getElementById('editUnitDescription').value = unit.unitDescription || '';
    
    // Update semester options based on selected course
    updateEditSemesterOptions();
    
    // Open edit modal
    openEditUnitModal();
}

function updateUnit(event) {
    event.preventDefault();
    
    const unitKey = document.getElementById('editUnitKey').value;
    const unitCode = document.getElementById('editUnitCode').value.trim();
    const unitName = document.getElementById('editUnitName').value.trim();
    const courseCode = document.getElementById('editUnitCourse').value;
    const unitSemester = document.getElementById('editUnitSemester').value;
    const unitType = document.getElementById('editUnitType').value;
    const unitCredits = parseInt(document.getElementById('editUnitCredits').value);
    const unitDescription = document.getElementById('editUnitDescription').value.trim();
    
    if (!unitCode || !unitName || !courseCode || !unitSemester || !unitType || !unitCredits) {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    const unitData = {
        unitCode,
        unitName,
        courseCode,
        unitSemester,
        unitType,
        unitCredits,
        unitDescription,
        timestamp: Date.now()
    };
    
    // Check if unit code already exists (excluding current unit)
    const existingUnit = Object.values(units).find(u => u.unitCode === unitCode && units[Object.keys(units).find(key => units[key].unitCode === unitCode)] !== units[unitKey]);
    if (existingUnit) {
        showToast('Unit with this code already exists!', 'error');
        return;
    }
    
    db.ref(`units/${unitKey}`).update(unitData)
        .then(() => {
            showToast('Unit updated successfully!');
            closeEditUnitModal();
        })
        .catch(error => {
            console.error('Error updating unit:', error);
            showToast('Error updating unit. Please try again.', 'error');
        });
}

// ========== DELETE UNIT FUNCTION ==========
function deleteUnit(unitKey, unitCode) {
    // Set up confirmation modal
    document.getElementById('deleteUnitKey').value = unitKey;
    document.getElementById('deleteUnitCode').value = unitCode;
    document.getElementById('confirmDeleteText').textContent = 
        `Are you sure you want to delete unit "${unitCode}"? This action cannot be undone.`;
    
    openConfirmDeleteModal();
}

function confirmDeleteUnit() {
    const unitKey = document.getElementById('deleteUnitKey').value;
    const unitCode = document.getElementById('deleteUnitCode').value;
    
    db.ref(`units/${unitKey}`).remove()
        .then(() => {
            showToast('Unit deleted successfully!');
            closeConfirmDeleteModal();
        })
        .catch(error => {
            console.error('Error deleting unit:', error);
            showToast('Error deleting unit. Please try again.', 'error');
        });
}

// ========== VIEW FUNCTIONS ==========
function viewUnits(courseCode) {
    const courseUnits = Object.values(units).filter(unit => unit.courseCode === courseCode);
    const course = Object.values(courses).find(c => c.courseCode === courseCode);
    
    if (courseUnits.length === 0) {
        showToast(`No units found for ${courseCode}`, 'warning');
        return;
    }
    
    // Set modal title
    document.getElementById('viewUnitsTitle').textContent = 
        `Units for ${course ? course.courseName : courseCode} (${courseUnits.length} units)`;
    
    // Clear previous content
    const unitsListBody = document.getElementById('unitsListBody');
    unitsListBody.innerHTML = '';
    
    // Add units to table
    courseUnits.forEach(unit => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><strong>${unit.unitCode}</strong></td>
            <td>${unit.unitName}</td>
            <td><span class="unit-type ${unit.unitType || 'core'}">${unit.unitType || 'core'}</span></td>
            <td>${unit.unitCredits || 'N/A'}</td>
            <td>${unit.unitSemester || 'N/A'}</td>
            <td>
                <div class="table-actions">
                    <button class="action-btn view" onclick="viewUnit('${unit.unitCode}')" title="View Details">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="action-btn edit" onclick="editUnitInList('${unit.unitCode}')" title="Edit Unit">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            </td>
        `;
        unitsListBody.appendChild(row);
    });
    
    // Open modal
    openViewUnitsModal();
}

function editUnitInList(unitCode) {
    const unitEntry = Object.entries(units).find(([key, unit]) => unit.unitCode === unitCode);
    if (unitEntry) {
        const [unitKey, unit] = unitEntry;
        editUnitInTable(unitKey, unitCode);
        closeViewUnitsModal();
    }
}

function viewUnit(unitCode) {
    const unitEntry = Object.entries(units).find(([key, unit]) => unit.unitCode === unitCode);
    if (!unitEntry) {
        showToast('Unit not found!', 'error');
        return;
    }
    
    const [unitKey, unit] = unitEntry;
    const course = Object.values(courses).find(c => c.courseCode === unit.courseCode);
    const courseName = course ? course.courseName : unit.courseCode;
    
    // Set modal title
    document.getElementById('viewUnitTitle').textContent = 
        `${unit.unitCode} - ${unit.unitName}`;
    
    // Populate details table
    const detailsTable = document.getElementById('unitDetailsTable');
    detailsTable.innerHTML = `
        <tr>
            <th>Unit Code</th>
            <td>${unit.unitCode}</td>
        </tr>
        <tr>
            <th>Unit Name</th>
            <td>${unit.unitName}</td>
        </tr>
        <tr>
            <th>Course</th>
            <td>${courseName}</td>
        </tr>
        <tr>
            <th>Semester</th>
            <td>${unit.unitSemester || 'N/A'}</td>
        </tr>
        <tr>
            <th>Unit Type</th>
            <td><span class="unit-type ${unit.unitType || 'core'}">${unit.unitType || 'core'}</span></td>
        </tr>
        <tr>
            <th>Credit Hours</th>
            <td>${unit.unitCredits || 'N/A'}</td>
        </tr>
        <tr>
            <th>Description</th>
            <td>${unit.unitDescription || 'No description provided'}</td>
        </tr>
        <tr>
            <th>Date Added</th>
            <td>${unit.timestamp ? new Date(unit.timestamp).toLocaleDateString() : 'N/A'}</td>
        </tr>
        <tr>
            <th>Actions</th>
            <td>
                <div class="table-actions">
                    <button class="action-btn edit" onclick="editUnitInTable('${unitKey}', '${unit.unitCode}'); closeViewUnitModal();">Edit</button>
                    <button class="action-btn delete" onclick="deleteUnit('${unitKey}', '${unit.unitCode}'); closeViewUnitModal();">Delete</button>
                </div>
            </td>
        </tr>
    `;
    
    // Open modal
    openViewUnitModal();
}

function viewCourse(courseCode) {
    const course = Object.values(courses).find(c => c.courseCode === courseCode);
    if (!course) {
        showToast('Course not found!', 'error');
        return;
    }
    
    alert(`Course Details:\n\n` +
          `Code: ${course.courseCode}\n` +
          `Name: ${course.courseName}\n` +
          `Department: ${course.courseDepartment}\n` +
          `Level: ${course.courseLevel}\n` +
          `Fee: KES ${course.courseFee ? course.courseFee.toLocaleString() : 'N/A'}\n` +
          `Exam Body: ${course.examBody}\n` +
          `Description: ${course.courseDescription || 'No description'}`);
}

function viewTrainerDetails(trainerId) {
    const trainer = Object.values(trainers).find(t => t.trainerId === trainerId);
    if (!trainer) {
        showToast('Trainer not found!', 'error');
        return;
    }
    
    // Find units assigned to this trainer
    const assignedUnits = Object.values(units).filter(unit => unit.assignedTrainer === trainerId);
    
    alert(`Trainer Details:\n\n` +
          `Name: ${trainer.trainerName}\n` +
          `Department: ${trainer.trainerDepartment}\n` +
          `Specialization: ${trainer.trainerSpecialization || 'N/A'}\n` +
          `Email: ${trainer.trainerEmail}\n` +
          `Phone: ${trainer.trainerPhone || 'N/A'}\n` +
          `Status: ${trainer.status}\n` +
          `Qualifications: ${trainer.trainerQualifications || 'N/A'}\n` +
          `Assigned Units: ${assignedUnits.length}\n` +
          `Units: ${assignedUnits.map(u => u.unitCode).join(', ') || 'None'}`);
}

function viewSchedule(scheduleId) {
    const schedule = Object.values(schedules).find(s => s.scheduleId === scheduleId);
    if (!schedule) {
        showToast('Schedule not found!', 'error');
        return;
    }
    
    const unit = Object.values(units).find(u => u.unitCode === schedule.unitCode);
    const trainer = Object.values(trainers).find(t => t.trainerId === schedule.trainerId);
    
    alert(`Class Schedule Details:\n\n` +
          `Unit: ${unit ? unit.unitName : schedule.unitCode}\n` +
          `Trainer: ${trainer ? trainer.trainerName : 'Unknown'}\n` +
          `Day: ${schedule.scheduleDay}\n` +
          `Time: ${schedule.scheduleTime}\n` +
          `Venue: ${schedule.scheduleVenue}\n` +
          `Type: ${schedule.scheduleType}`);
}

function editCourse(courseCode) {
    const course = Object.values(courses).find(c => c.courseCode === courseCode);
    if (!course) {
        showToast('Course not found!', 'error');
        return;
    }
    
    openAddCourseModal();
    
    // Populate form with course data
    setTimeout(() => {
        document.getElementById('courseCode').value = course.courseCode;
        document.getElementById('courseName').value = course.courseName;
        document.getElementById('courseDepartment').value = course.courseDepartment;
        document.getElementById('courseLevel').value = course.courseLevel;
        document.getElementById('courseFee').value = course.courseFee;
        document.getElementById('examBody').value = course.examBody;
        document.getElementById('courseDescription').value = course.courseDescription || '';
    }, 100);
    
    // Change form to update mode
    const form = document.getElementById('courseForm');
    form.onsubmit = function(event) {
        event.preventDefault();
        updateCourse(courseCode);
    };
    
    const submitBtn = form.querySelector('button[type="submit"]');
    submitBtn.textContent = 'Update Course';
    submitBtn.className = 'btn btn-primary';
}

function updateCourse(courseCode) {
    const courseName = document.getElementById('courseName').value.trim();
    const courseDepartment = document.getElementById('courseDepartment').value;
    const courseLevel = document.getElementById('courseLevel').value;
    const courseFee = parseFloat(document.getElementById('courseFee').value);
    const examBody = document.getElementById('examBody').value;
    const courseDescription = document.getElementById('courseDescription').value.trim();
    
    if (!courseName || !courseDepartment || !courseLevel || !courseFee || !examBody) {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    const courseData = {
        courseCode,
        courseName,
        courseDepartment,
        courseLevel,
        courseFee,
        examBody,
        courseDescription,
        timestamp: Date.now()
    };
    
    // Find the key of the course
    const courseKey = Object.keys(courses).find(key => courses[key].courseCode === courseCode);
    
    if (courseKey) {
        db.ref(`courses/${courseKey}`).update(courseData)
            .then(() => {
                showToast('Course updated successfully!');
                closeAddCourseModal();
                // Reset form to add mode
                const form = document.getElementById('courseForm');
                form.onsubmit = addNewCourse;
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Add Course';
            })
            .catch(error => {
                console.error('Error updating course:', error);
                showToast('Error updating course. Please try again.', 'error');
            });
    }
}

function editTrainer(trainerId) {
    const trainer = Object.values(trainers).find(t => t.trainerId === trainerId);
    if (!trainer) {
        showToast('Trainer not found!', 'error');
        return;
    }
    
    openAddTrainerModal();
    
    // Populate form with trainer data
    setTimeout(() => {
        document.getElementById('trainerName').value = trainer.trainerName;
        document.getElementById('trainerDepartment').value = trainer.trainerDepartment;
        document.getElementById('trainerSpecialization').value = trainer.trainerSpecialization || '';
        document.getElementById('trainerEmail').value = trainer.trainerEmail;
        document.getElementById('trainerPhone').value = trainer.trainerPhone || '';
        document.getElementById('trainerQualifications').value = trainer.trainerQualifications || '';
    }, 100);
    
    // Change form to update mode
    const form = document.getElementById('trainerForm');
    form.onsubmit = function(event) {
        event.preventDefault();
        updateTrainer(trainerId);
    };
    
    const submitBtn = form.querySelector('button[type="submit"]');
    submitBtn.textContent = 'Update Trainer';
    submitBtn.className = 'btn btn-primary';
}

function updateTrainer(trainerId) {
    const trainerName = document.getElementById('trainerName').value.trim();
    const trainerDepartment = document.getElementById('trainerDepartment').value;
    const trainerSpecialization = document.getElementById('trainerSpecialization').value.trim();
    const trainerEmail = document.getElementById('trainerEmail').value.trim();
    const trainerPhone = document.getElementById('trainerPhone').value.trim();
    const trainerQualifications = document.getElementById('trainerQualifications').value.trim();
    
    if (!trainerName || !trainerDepartment || !trainerEmail) {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    const trainerData = {
        trainerId,
        trainerName,
        trainerDepartment,
        trainerSpecialization,
        trainerEmail,
        trainerPhone,
        trainerQualifications,
        timestamp: Date.now()
    };
    
    // Find the key of the trainer
    const trainerKey = Object.keys(trainers).find(key => trainers[key].trainerId === trainerId);
    
    if (trainerKey) {
        db.ref(`trainers/${trainerKey}`).update(trainerData)
            .then(() => {
                showToast('Trainer updated successfully!');
                closeAddTrainerModal();
                // Reset form to add mode
                const form = document.getElementById('trainerForm');
                form.onsubmit = addNewTrainer;
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Add Trainer';
            })
            .catch(error => {
                console.error('Error updating trainer:', error);
                showToast('Error updating trainer. Please try again.', 'error');
            });
    }
}

function editSchedule(scheduleId) {
    const schedule = Object.values(schedules).find(s => s.scheduleId === scheduleId);
    if (!schedule) {
        showToast('Schedule not found!', 'error');
        return;
    }
    
    openAddScheduleModal();
    
    // Populate form with schedule data
    setTimeout(() => {
        document.getElementById('scheduleUnit').value = schedule.unitCode;
        document.getElementById('scheduleTrainer').value = schedule.trainerId;
        document.getElementById('scheduleDay').value = schedule.scheduleDay;
        document.getElementById('scheduleTime').value = schedule.scheduleTime;
        document.getElementById('scheduleVenue').value = schedule.scheduleVenue;
        document.getElementById('scheduleType').value = schedule.scheduleType;
    }, 100);
    
    // Change form to update mode
    const form = document.getElementById('scheduleForm');
    form.onsubmit = function(event) {
        event.preventDefault();
        updateSchedule(scheduleId);
    };
    
    const submitBtn = form.querySelector('button[type="submit"]');
    submitBtn.textContent = 'Update Schedule';
    submitBtn.className = 'btn btn-primary';
}

function updateSchedule(scheduleId) {
    const unitCode = document.getElementById('scheduleUnit').value;
    const trainerId = document.getElementById('scheduleTrainer').value;
    const scheduleDay = document.getElementById('scheduleDay').value;
    const scheduleTime = document.getElementById('scheduleTime').value;
    const scheduleVenue = document.getElementById('scheduleVenue').value.trim();
    const scheduleType = document.getElementById('scheduleType').value;
    
    if (!unitCode || !trainerId || !scheduleDay || !scheduleTime || !scheduleVenue || !scheduleType) {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    const scheduleData = {
        scheduleId,
        unitCode,
        trainerId,
        scheduleDay,
        scheduleTime,
        scheduleVenue,
        scheduleType,
        timestamp: Date.now()
    };
    
    // Find the key of the schedule
    const scheduleKey = Object.keys(schedules).find(key => schedules[key].scheduleId === scheduleId);
    
    if (scheduleKey) {
        db.ref(`schedules/${scheduleKey}`).update(scheduleData)
            .then(() => {
                showToast('Schedule updated successfully!');
                closeAddScheduleModal();
                // Reset form to add mode
                const form = document.getElementById('scheduleForm');
                form.onsubmit = addNewSchedule;
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Schedule Class';
            })
            .catch(error => {
                console.error('Error updating schedule:', error);
                showToast('Error updating schedule. Please try again.', 'error');
            });
    }
}

// ========== DELETE COURSE FUNCTION ==========
function deleteCourse(courseCode) {
    // Check if there are units associated with this course
    const courseUnits = Object.values(units).filter(unit => unit.courseCode === courseCode);
    
    if (courseUnits.length > 0) {
        if (!confirm(`This course has ${courseUnits.length} units associated with it. Deleting the course will not delete the units, but they will no longer be linked to a course. Do you want to proceed?`)) {
            return;
        }
    }
    
    if (!confirm(`Are you sure you want to delete course "${courseCode}"? This action cannot be undone.`)) {
        return;
    }
    
    // Find the key of the course
    const courseKey = Object.keys(courses).find(key => courses[key].courseCode === courseCode);
    
    if (courseKey) {
        db.ref(`courses/${courseKey}`).remove()
            .then(() => {
                showToast('Course deleted successfully!');
            })
            .catch(error => {
                console.error('Error deleting course:', error);
                showToast('Error deleting course. Please try again.', 'error');
            });
    } else {
        showToast('Course not found!', 'error');
    }
}

// ========== SEARCH FUNCTIONALITY ==========
document.getElementById('searchButton').addEventListener('click', performSearch);
document.getElementById('mobileSearchButton').addEventListener('click', performMobileSearch);

// Enter key search
document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') performSearch();
});

document.getElementById('mobileSearchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') performMobileSearch();
});

function performSearch() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
    if (!searchTerm) return;
    
    searchAllData(searchTerm);
}

function performMobileSearch() {
    const searchTerm = document.getElementById('mobileSearchInput').value.toLowerCase().trim();
    if (!searchTerm) return;
    
    searchAllData(searchTerm);
    closeMobileSearch();
}

function searchAllData(term) {
    let results = [];
    
    // Search in courses
    Object.values(courses).forEach(course => {
        if (course.courseCode.toLowerCase().includes(term) || 
            course.courseName.toLowerCase().includes(term) ||
            (course.courseDepartment && course.courseDepartment.toLowerCase().includes(term))) {
            results.push({
                type: 'Course',
                code: course.courseCode,
                name: course.courseName,
                department: course.courseDepartment,
                action: () => viewCourse(course.courseCode)
            });
        }
    });
    
    // Search in units
    Object.values(units).forEach(unit => {
        if (unit.unitCode.toLowerCase().includes(term) || 
            unit.unitName.toLowerCase().includes(term)) {
            results.push({
                type: 'Unit',
                code: unit.unitCode,
                name: unit.unitName,
                department: unit.courseCode,
                action: () => viewUnit(unit.unitCode)
            });
        }
    });
    
    // Search in trainers
    Object.values(trainers).forEach(trainer => {
        if (trainer.trainerName.toLowerCase().includes(term) || 
            (trainer.trainerDepartment && trainer.trainerDepartment.toLowerCase().includes(term))) {
            results.push({
                type: 'Trainer',
                code: trainer.trainerId,
                name: trainer.trainerName,
                department: trainer.trainerDepartment,
                action: () => viewTrainerDetails(trainer.trainerId)
            });
        }
    });
    
    displaySearchResults(results);
}

function displaySearchResults(results) {
    if (results.length === 0) {
        showToast('No results found for your search.', 'warning');
        return;
    }
    
    let message = `Found ${results.length} result(s):\n\n`;
    results.forEach((result, index) => {
        message += `${index + 1}. [${result.type}] ${result.code} - ${result.name}\n   Department: ${result.department}\n\n`;
    });
    
    message += 'Click OK to view the first result, or Cancel to close.';
    
    if (confirm(message)) {
        results[0].action();
    }
}

// Mobile Search Toggle
document.getElementById('mobileSearchBtn').addEventListener('click', function() {
    const mobileSearchContainer = document.getElementById('mobileSearchContainer');
    if (mobileSearchContainer.style.display === 'block') {
        closeMobileSearch();
    } else {
        openMobileSearch();
    }
});

function openMobileSearch() {
    document.getElementById('mobileSearchContainer').style.display = 'block';
    document.getElementById('mobileSearchInput').focus();
}

function closeMobileSearch() {
    document.getElementById('mobileSearchContainer').style.display = 'none';
    document.getElementById('mobileSearchInput').value = '';
}

// Quick Add Unit for specific course
function quickAddUnitForCourse(courseCode) {
    openAddUnitModal();
    // Pre-select the course in the dropdown
    setTimeout(() => {
        const courseSelect = document.getElementById('unitCourse');
        courseSelect.value = courseCode;
        updateSemesterOptions();
    }, 100);
}

// Export Units function
function exportUnits() {
    if (Object.keys(units).length === 0) {
        showToast('No units to export.', 'warning');
        return;
    }
    
    let csvContent = "Unit Code,Unit Name,Course Code,Type,Credits,Semester,Description\n";
    
    Object.values(units).forEach(unit => {
        const row = [
            unit.unitCode,
            unit.unitName,
            unit.courseCode,
            unit.unitType,
            unit.unitCredits,
            unit.unitSemester,
            unit.unitDescription || ''
        ].map(field => `"${field}"`).join(',');
        
        csvContent += row + "\n";
    });
    
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `units_export_${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
    
    showToast('Units exported successfully!');
}

// Settings functions
function saveSettings() {
    const settings = {
        notifications: document.getElementById('notificationsToggle').checked,
        autosave: document.getElementById('autosaveToggle').checked,
        darkMode: document.getElementById('darkModeToggle').checked,
        exportEnabled: document.getElementById('exportToggle').checked,
        lastUpdated: Date.now()
    };
    
    localStorage.setItem('ucst_settings', JSON.stringify(settings));
    
    // Apply dark mode if toggled
    if (settings.darkMode) {
        document.body.classList.add('dark');
        document.getElementById('toggleTheme').textContent = 'â˜€ï¸';
        localStorage.setItem('theme', 'dark');
    } else {
        document.body.classList.remove('dark');
        document.getElementById('toggleTheme').textContent = 'ðŸŒ™';
        localStorage.setItem('theme', 'light');
    }
    
    showToast('Settings saved successfully!');
    closeSettingsModal();
}

// ========== TAB FUNCTIONALITY ==========
document.querySelectorAll('.tab-btn').forEach(button => {
    button.addEventListener('click', () => {
        // Remove active class from all tabs
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        
        // Add active class to clicked tab
        button.classList.add('active');
        document.getElementById(button.dataset.tab).classList.add('active');
    });
});

// ========== THEME TOGGLE ==========
document.getElementById("toggleTheme").addEventListener("click", function() {
    document.body.classList.toggle("dark");
    this.textContent = document.body.classList.contains("dark") ? "â˜€ï¸" : "ðŸŒ™";
    localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    
    // Update settings if they exist
    const settings = JSON.parse(localStorage.getItem('ucst_settings') || '{}');
    settings.darkMode = document.body.classList.contains('dark');
    localStorage.setItem('ucst_settings', JSON.stringify(settings));
});

// Quick Add Unit Button
document.getElementById('quickAddUnit').addEventListener('click', function() {
    openAddUnitModal();
});

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', function() {
    // Load saved settings
    const savedSettings = JSON.parse(localStorage.getItem('ucst_settings') || '{}');
    
    // Apply dark mode if saved
    if (savedSettings.darkMode) {
        document.body.classList.add('dark');
        document.getElementById('toggleTheme').textContent = 'â˜€ï¸';
    } else {
        // Fallback to old theme setting
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark');
            document.getElementById('toggleTheme').textContent = 'â˜€ï¸';
        }
    }
    
    // Load data
    loadData();
    
    console.log('Enhanced UCST Course Management System Loaded');
    console.log('Firebase connected successfully');
});

// Close modals when clicking outside
window.addEventListener('click', function(event) {
    const modals = ['addCourseModal', 'addUnitModal', 'editUnitModal', 'addTrainerModal', 'addScheduleModal', 'settingsModal', 'viewUnitsModal', 'viewUnitModal', 'confirmDeleteModal'];
    modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (event.target === modal) {
            if (modalId === 'addCourseModal') closeAddCourseModal();
            if (modalId === 'addUnitModal') closeAddUnitModal();
            if (modalId === 'editUnitModal') closeEditUnitModal();
            if (modalId === 'addTrainerModal') closeAddTrainerModal();
            if (modalId === 'addScheduleModal') closeAddScheduleModal();
            if (modalId === 'settingsModal') closeSettingsModal();
            if (modalId === 'viewUnitsModal') closeViewUnitsModal();
            if (modalId === 'viewUnitModal') closeViewUnitModal();
            if (modalId === 'confirmDeleteModal') closeConfirmDeleteModal();
        }
    });
});
</script>
</body>
</html>