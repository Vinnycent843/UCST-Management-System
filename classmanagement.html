<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UCST - Complete Class Management</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: #f8f9fa;
            padding-top: 100px;
            color: #333;
        }

        /* Navbar Styles */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fff;
            padding: 10px 20px;
            border-bottom: 1px solid #141212;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .logo img {
            height: 90px;
            width: auto;
        }

        .menu-toggle {
            display: none;
            font-size: 28px;
            cursor: pointer;
            color: #007bff;
        }

        .nav-links {
            display: flex;
            gap: 20px;
            list-style: none;
            align-items: center;
        }

        .nav-links li a {
            text-decoration: none;
            color: #000;
            padding: 10px;
            display: block;
            position: relative;
            font-weight: 500;
        }

        .nav-links li a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 50%;
            background-color: #007bff;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-links li a:hover::after {
            width: 80%;
        }

        .nav-links li a.active {
            color: #007bff;
        }

        .nav-links li a.active::after {
            width: 80%;
            background-color: #007bff;
        }

        .cta-button {
            background: #007bff;
            border-radius: 6px;
        }

        .cta-button a {
            background-color: #007bff;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            text-decoration: none;
            display: block;
        }

        .cta-button:hover {
            background: #0056b3;
        }

        .cta-button a:hover {
            background: #0056b3;
            color: white;
        }

        .dropdown {
            position: relative;
        }

        .dropdown-content {
            position: absolute;
            background-color: #fff;
            top: 100%;
            left: 0;
            display: none;
            min-width: 220px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 99;
            border-radius: 5px;
            overflow: hidden;
        }

        .dropdown-content a {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .dropdown-content a:hover {
            background: #f8f9fa;
        }

        @media (min-width: 769px) {
            .dropdown:hover .dropdown-content {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }

            .nav-links {
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
                background-color: #fff;
                position: absolute;
                top: 100%;
                left: 0;
                display: none;
                padding: 20px;
                box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            }

            .nav-links.active {
                display: flex;
            }

            .dropdown-content {
                position: static;
                display: none;
                box-shadow: none;
                padding-left: 15px;
                width: 100%;
                margin-top: 10px;
            }

            .dropdown-content.show {
                display: block;
            }

            .nav-links li {
                width: 100%;
            }

            .cta-button a {
                width: 100%;
                text-align: center;
            }
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Welcome Section */
        .welcome-section {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: linear-gradient(135deg, #007bff, #6610f2);
            color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .welcome-section h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .welcome-section p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #007bff;
            display: inline-block;
            width: 60px;
            height: 60px;
            line-height: 60px;
            background: rgba(0,123,255,0.1);
            border-radius: 50%;
        }

        .card-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .card-label {
            color: #666;
            font-size: 1rem;
            font-weight: 500;
        }

        /* Control Panel */
        .control-panel {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
        }

        .control-panel h2 {
            color: #007BFF;
            margin-bottom: 25px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .filter-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .filter-select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.2);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
        }

        .btn-primary {
            background: #007BFF;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40,167,69,0.3);
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,193,7,0.3);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220,53,69,0.3);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        /* Classes Container */
        .classes-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        @media (max-width: 768px) {
            .classes-container {
                grid-template-columns: 1fr;
            }
        }

        /* Class Card */
        .class-card {
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
        }

        .class-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #007bff;
        }

        .class-card-header {
            background: linear-gradient(90deg, #007BFF, #3943d6);
            color: white;
            padding: 20px;
            position: relative;
        }

        .class-card-header h3 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .class-code {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 8px;
        }

        .class-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 4px;
            color: white;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .class-card-body {
            padding: 25px;
        }

        /* Class Info Grid */
        .class-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .info-value {
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        /* Section Titles */
        .section-title {
            color: #007BFF;
            margin: 20px 0 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f0f0;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .count-badge {
            background: #007bff;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Students Section */
        .students-section {
            margin-top: 20px;
        }

        .students-list {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .student-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            background: white;
        }

        .student-item:last-child {
            border-bottom: none;
        }

        .student-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #007bff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .student-info {
            flex: 1;
            min-width: 0;
        }

        .student-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .student-detail {
            font-size: 0.85rem;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .remove-student {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .remove-student:hover {
            background: #c82333;
            transform: scale(1.1);
        }

        /* Trainer Section */
        .trainer-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .trainer-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .trainer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #28a745;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .trainer-details {
            flex: 1;
            min-width: 0;
        }

        .trainer-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .trainer-qualification {
            font-size: 0.9rem;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* View Class Button */
        .view-class-btn {
            width: 100%;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px dashed #ddd;
            margin: 20px 0;
        }

        .empty-state i {
            font-size: 4rem;
            color: #ccc;
            margin-bottom: 20px;
            display: block;
        }

        .empty-state h3 {
            color: #666;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .empty-state p {
            color: #999;
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        /* Loading Spinner */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            font-size: 1.2rem;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007BFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: #dc3545;
            background: #f8f9fa;
        }

        .modal h2 {
            color: #007BFF;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Student Search */
        .student-search {
            margin-bottom: 20px;
        }

        .search-input {
            position: relative;
        }

        .search-input i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .search-input input {
            padding-left: 45px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
            padding: 12px 15px 12px 45px;
            font-size: 1rem;
        }

        /* Student List in Modal */
        .students-list-modal {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .student-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .student-option:hover {
            background: #f8f9fa;
        }

        .student-option.selected {
            background: rgba(0,123,255,0.1);
            border-left: 4px solid #007bff;
        }

        .student-option-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #007bff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .student-option-info {
            flex: 1;
            min-width: 0;
        }

        .student-option-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .student-option-details {
            font-size: 0.85rem;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Trainer List in Modal */
        .trainers-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .trainer-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .trainer-option:hover {
            background: #f8f9fa;
        }

        .trainer-option.selected {
            background: rgba(40,167,69,0.1);
            border-left: 4px solid #28a745;
        }

        .trainer-option-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #28a745;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .trainer-option-info {
            flex: 1;
            min-width: 0;
        }

        .trainer-option-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .trainer-option-details {
            font-size: 0.85rem;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Class Details Modal */
        .class-details-content {
            margin-top: 20px;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .detail-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .detail-item h4 {
            color: #007BFF;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .detail-item p {
            color: #555;
            line-height: 1.5;
        }

        .detail-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        /* Success Message */
        .success-message {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 400px;
        }

        .success-message.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Print Button */
        .print-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .print-btn:hover {
            background: #0056b3;
            transform: scale(1.1);
        }

        /* Tabs for Modals */
        .modal-tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .modal-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            white-space: nowrap;
            flex: 1;
            min-width: 150px;
            text-align: center;
        }

        .modal-tab.active {
            color: #007bff;
            border-bottom: 3px solid #007bff;
        }

        .modal-tab-content {
            display: none;
        }

        .modal-tab-content.active {
            display: block;
        }

        /* New Trainer Form in Modal */
        .new-trainer-form {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        /* Mobile-Specific Modal Styles */
        @media (max-width: 768px) {
            .modal {
                padding: 10px;
                align-items: flex-start;
            }
            
            .modal-content {
                padding: 20px;
                max-height: 85vh;
                margin-top: 60px;
            }
            
            .modal-tabs {
                flex-direction: column;
            }
            
            .modal-tab {
                width: 100%;
                text-align: left;
                padding: 10px 15px;
            }
            
            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 10px 12px;
                font-size: 0.95rem;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .student-option,
            .trainer-option {
                padding: 10px;
                flex-wrap: wrap;
            }
            
            .student-option-avatar,
            .trainer-option-avatar {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 80px;
            }

            .welcome-section h1 {
                font-size: 1.8rem;
            }

            .welcome-section p {
                font-size: 1rem;
            }

            .dashboard-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .classes-container {
                grid-template-columns: 1fr;
            }

            .class-info-grid {
                grid-template-columns: 1fr;
            }

            .class-actions {
                position: static;
                margin-top: 15px;
                justify-content: flex-start;
                flex-wrap: wrap;
            }

            .class-card-header h3 {
                font-size: 1.1rem;
            }

            .class-code {
                font-size: 0.8rem;
                padding: 3px 8px;
            }

            .print-btn {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }

            .success-message {
                bottom: 20px;
                right: 20px;
                left: 20px;
                text-align: center;
                padding: 12px 20px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 15px;
            }
            
            .welcome-section {
                padding: 25px 15px;
            }
            
            .welcome-section h1 {
                font-size: 1.5rem;
            }
            
            .control-panel {
                padding: 20px 15px;
            }
            
            .class-card {
                margin: 0 -10px;
                border-radius: 0;
                border-left: none;
                border-right: none;
            }
            
            .class-card-body {
                padding: 20px 15px;
            }
            
            .info-box {
                padding: 12px;
            }
            
            .student-avatar {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
            
            .trainer-avatar {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
        }

        @media print {
            .navbar, .control-panel, .print-btn, .class-actions, .btn {
                display: none !important;
            }

            body {
                padding-top: 0;
                background: white;
            }

            .class-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ccc;
                margin-bottom: 20px;
            }

            .students-list {
                max-height: none;
                overflow: visible;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">
            <a href="index.html">
                <img src="images/logo.jpg" alt="UCST Logo" />
            </a>
        </div>

        <div class="menu-toggle" id="menu-toggle">â˜°</div>

        <ul class="nav-links" id="nav-links">
            <li><a href="index.html">Home</a></li>
            <li class="dropdown">
                <a href="#">Our Courses</a>
                <ul class="dropdown-content">
                    <li><a href="computing.html">Computing & Informatics</a></li>
                    <li><a href="business.html">Business & Entrepreneurship</a></li>
                    <li><a href="engineering.html">Engineering</a></li>
                    <li><a href="hospitality.html">Hospitality & Tourism</a></li>
                </ul>
            </li>
            <li><a href="class-management.html" class="active">Class Management</a></li>
            <li><a href="news.html">News</a></li>
            <li><a href="background.html">About Us</a></li>
            <li><a href="application.html">Online Application</a></li>
            <li><a href="contacts.html">Contacts</a></li>
            <li class="cta-button"><a href="#" id="adminToggleBtn">Admin Login</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1>ðŸŽ“ UCST Class Management System</h1>
            <p>Complete solution for managing classes, trainers, and student assignments. Organize by department, course, module, intake, and year.</p>
        </div>

        <!-- Dashboard Cards -->
        <div class="dashboard-cards">
            <div class="dashboard-card">
                <div class="card-icon"><i class="fas fa-chalkboard"></i></div>
                <div class="card-value" id="totalClasses">0</div>
                <div class="card-label">Active Classes</div>
            </div>
            <div class="dashboard-card">
                <div class="card-icon"><i class="fas fa-user-graduate"></i></div>
                <div class="card-value" id="totalStudents">0</div>
                <div class="card-label">Total Students</div>
            </div>
            <div class="dashboard-card">
                <div class="card-icon"><i class="fas fa-chalkboard-teacher"></i></div>
                <div class="card-value" id="totalTrainers">0</div>
                <div class="card-label">Active Trainers</div>
            </div>
            <div class="dashboard-card">
                <div class="card-icon"><i class="fas fa-building"></i></div>
                <div class="card-value" id="totalDepartments">0</div>
                <div class="card-label">Departments</div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <h2><i class="fas fa-sliders-h"></i> Class Filter & Management</h2>
            
            <div class="filter-grid">
                <div class="filter-group">
                    <label for="departmentFilter"><i class="fas fa-building"></i> Department</label>
                    <select id="departmentFilter" class="filter-select">
                        <option value="all">All Departments</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="courseFilter"><i class="fas fa-book"></i> Course</label>
                    <select id="courseFilter" class="filter-select">
                        <option value="all">All Courses</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="moduleFilter"><i class="fas fa-layer-group"></i> Module</label>
                    <select id="moduleFilter" class="filter-select">
                        <option value="all">All Modules</option>
                        <option value="1">Module 1</option>
                        <option value="2">Module 2</option>
                        <option value="3">Module 3</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="intakeFilter"><i class="fas fa-calendar-alt"></i> Intake</label>
                    <select id="intakeFilter" class="filter-select">
                        <option value="all">All Intakes</option>
                        <option value="JAN">January</option>
                        <option value="MAY">May</option>
                        <option value="SEP">September</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="yearFilter"><i class="fas fa-calendar"></i> Year</label>
                    <select id="yearFilter" class="filter-select">
                        <option value="all">All Years</option>
                    </select>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-success" onclick="openAddClassModal()">
                    <i class="fas fa-plus-circle"></i> Add New Class
                </button>
                <button class="btn btn-primary" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>
                <button class="btn btn-info" onclick="openAddDirectStudentModal()">
                    <i class="fas fa-user-plus"></i> Add Student Directly
                </button>
                <button class="btn btn-warning" onclick="initializeSampleData()">
                    <i class="fas fa-database"></i> Initialize Sample Data
                </button>
                <button class="btn btn-warning" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> Export to Excel
                </button>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading">Loading class data...</div>

        <!-- Classes Container -->
        <div class="classes-container" id="classesContainer">
            <!-- Classes will be loaded here dynamically -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state" style="display: none;">
            <i class="fas fa-chalkboard-teacher"></i>
            <h3>No Classes Found</h3>
            <p>Try adjusting your filters or add a new class for the selected criteria</p>
            <button class="btn btn-success" onclick="openAddClassModal()">
                <i class="fas fa-plus-circle"></i> Add Your First Class
            </button>
        </div>
    </div>

    <!-- Print Button -->
    <button class="print-btn" onclick="window.print()">
        <i class="fas fa-print"></i>
    </button>

    <!-- Success Message -->
    <div class="success-message" id="successMessage">
        <i class="fas fa-check-circle"></i>
        <span id="successText">Operation completed successfully!</span>
    </div>

    <!-- Add/Edit Class Modal -->
    <div class="modal" id="classModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('classModal')">Ã—</button>
            <h2 id="modalTitle">Add New Class</h2>
            
            <form id="classForm" onsubmit="saveClass(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="classDepartment">Department *</label>
                        <select id="classDepartment" class="filter-select" required onchange="updateClassModalCourses()">
                            <option value="">Select Department</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="classCourse">Course *</label>
                        <select id="classCourse" class="filter-select" required onchange="updateClassName()">
                            <option value="">Select Course</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="classModule">Module *</label>
                        <select id="classModule" class="filter-select" required onchange="updateClassName()">
                            <option value="">Select Module</option>
                            <option value="1">Module 1</option>
                            <option value="2">Module 2</option>
                            <option value="3">Module 3</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="classIntake">Intake *</label>
                        <select id="classIntake" class="filter-select" required onchange="updateClassName()">
                            <option value="">Select Intake</option>
                            <option value="JAN">January</option>
                            <option value="MAY">May</option>
                            <option value="SEP">September</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="classYear">Year *</label>
                        <select id="classYear" class="filter-select" required onchange="updateClassName()">
                            <option value="">Select Year</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="classCapacity">Student Capacity</label>
                        <input type="number" id="classCapacity" min="1" max="100" value="30">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="className">Class Name (Auto-generated)</label>
                    <input type="text" id="className" readonly style="background: #f8f9fa;">
                </div>
                
                <div class="form-group">
                    <label for="classDescription">Class Description (Optional)</label>
                    <textarea id="classDescription" rows="3" placeholder="Enter class description..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="classSchedule">Class Schedule (Optional)</label>
                    <input type="text" id="classSchedule" placeholder="e.g., Mon-Wed 8:00 AM - 10:00 AM">
                </div>
                
                <div class="form-group">
                    <label for="classStatus">Status</label>
                    <select id="classStatus">
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Completed">Completed</option>
                    </select>
                </div>
                
                <div class="action-buttons">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save Class
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('classModal')">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Student to Class Modal -->
    <div class="modal" id="addStudentModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('addStudentModal')">Ã—</button>
            <h2>Add Student to Class</h2>
            
            <div class="form-group">
                <label>Selected Class</label>
                <input type="text" id="selectedClassForStudent" readonly style="background: #f8f9fa;">
                <input type="hidden" id="selectedClassIdForStudent">
            </div>
            
            <div class="modal-tabs">
                <div class="modal-tab active" data-tab="select-student">Select Existing Student</div>
                <div class="modal-tab" data-tab="add-student">Add New Student</div>
            </div>
            
            <!-- Select Existing Student Tab -->
            <div class="modal-tab-content active" id="select-student-tab">
                <div class="student-search">
                    <label>Search Admitted Students</label>
                    <div class="search-input">
                        <i class="fas fa-search"></i>
                        <input type="text" id="studentSearch" placeholder="Search by name, admission number, or email...">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Admitted Students</label>
                    <div class="students-list-modal" id="studentsListModal">
                        <!-- Students will be loaded here -->
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button type="button" class="btn btn-success" onclick="addSelectedStudent()">
                        <i class="fas fa-user-plus"></i> Add Selected Student
                    </button>
                </div>
            </div>
            
            <!-- Add New Student Tab -->
            <div class="modal-tab-content" id="add-student-tab">
                <form id="newStudentInClassForm" onsubmit="addNewStudentToClass(event)">
                    <div class="form-group">
                        <label for="newStudentDepartment">Department</label>
                        <input type="text" id="newStudentDepartment" readonly style="background: #f8f9fa;">
                    </div>
                    
                    <div class="form-group">
                        <label for="newStudentCourse">Course</label>
                        <input type="text" id="newStudentCourse" readonly style="background: #f8f9fa;">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newStudentFullName">Full Name *</label>
                            <input type="text" id="newStudentFullName" required placeholder="Enter student's full name">
                        </div>
                        
                        <div class="form-group">
                            <label for="newStudentEmail">Email *</label>
                            <input type="email" id="newStudentEmail" required placeholder="Enter email address">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newStudentPhone">Phone Number</label>
                            <input type="tel" id="newStudentPhone" placeholder="Enter phone number">
                        </div>
                        
                        <div class="form-group">
                            <label for="newStudentAdmNo">Admission Number *</label>
                            <input type="text" id="newStudentAdmNo" required placeholder="Enter admission number">
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-user-plus"></i> Add New Student
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="action-buttons" style="margin-top: 20px;">
                <button type="button" class="btn btn-danger" onclick="closeModal('addStudentModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Assign Trainer Modal -->
    <div class="modal" id="assignTrainerModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('assignTrainerModal')">Ã—</button>
            <h2>Assign Trainer to Class</h2>
            
            <div class="form-group">
                <label>Selected Class</label>
                <input type="text" id="selectedClassName" readonly style="background: #f8f9fa;">
                <input type="hidden" id="selectedClassId">
            </div>
            
            <div class="modal-tabs">
                <div class="modal-tab active" data-tab="select-trainer">Select Existing Trainer</div>
                <div class="modal-tab" data-tab="add-trainer">Add New Trainer</div>
            </div>
            
            <!-- Select Existing Trainer Tab -->
            <div class="modal-tab-content active" id="select-trainer-tab">
                <div class="form-group">
                    <label>Available Trainers</label>
                    <div class="trainers-list" id="trainersList">
                        <!-- Trainers will be loaded here -->
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button type="button" class="btn btn-success" onclick="assignSelectedTrainer()">
                        <i class="fas fa-user-check"></i> Assign Selected Trainer
                    </button>
                </div>
            </div>
            
            <!-- Add New Trainer Tab -->
            <div class="modal-tab-content" id="add-trainer-tab">
                <form id="newTrainerForm" onsubmit="addNewTrainer(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newTrainerFullName">Full Name *</label>
                            <input type="text" id="newTrainerFullName" required placeholder="Enter trainer's full name">
                        </div>
                        
                        <div class="form-group">
                            <label for="newTrainerEmail">Email *</label>
                            <input type="email" id="newTrainerEmail" required placeholder="Enter email address">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newTrainerPhone">Phone Number</label>
                            <input type="tel" id="newTrainerPhone" required placeholder="Enter phone number">
                        </div>
                        
                        <div class="form-group">
                            <label for="newTrainerQualification">Qualification *</label>
                            <input type="text" id="newTrainerQualification" required placeholder="e.g., Bachelor Degree in Computer Science">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newTrainerDepartment">Department *</label>
                            <input type="text" id="newTrainerDepartment" readonly style="background: #f8f9fa;">
                        </div>
                        
                        <div class="form-group">
                            <label for="newTrainerRegNo">Registration Number</label>
                            <input type="text" id="newTrainerRegNo" placeholder="Enter registration number">
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-user-plus"></i> Add & Assign Trainer
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="action-buttons" style="margin-top: 20px;">
                <button type="button" class="btn btn-danger" onclick="closeModal('assignTrainerModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Add Student Directly Modal -->
    <div class="modal" id="addDirectStudentModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('addDirectStudentModal')">Ã—</button>
            <h2>Add New Student Directly</h2>
            
            <form id="directStudentForm" onsubmit="saveDirectStudent(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="directDepartment">Department *</label>
                        <select id="directDepartment" class="filter-select" required onchange="updateDirectCourses()">
                            <option value="">Select Department</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="directCourse">Course *</label>
                        <select id="directCourse" class="filter-select" required>
                            <option value="">Select Course</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="directFullName">Full Name *</label>
                        <input type="text" id="directFullName" required placeholder="Enter student's full name">
                    </div>
                    
                    <div class="form-group">
                        <label for="directEmail">Email *</label>
                        <input type="email" id="directEmail" required placeholder="Enter email address">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="directPhone">Phone Number</label>
                        <input type="tel" id="directPhone" placeholder="Enter phone number">
                    </div>
                    
                    <div class="form-group">
                        <label for="directAdmNo">Admission Number *</label>
                        <input type="text" id="directAdmNo" required placeholder="Enter admission number">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="directClass">Assign to Class (Optional)</label>
                    <select id="directClass">
                        <option value="">Select Class (Optional)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="directStatus">Status</label>
                    <select id="directStatus">
                        <option value="Admitted">Admitted</option>
                        <option value="Pending">Pending</option>
                        <option value="Inactive">Inactive</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="directNotes">Additional Notes (Optional)</label>
                    <textarea id="directNotes" rows="3" placeholder="Any additional information..."></textarea>
                </div>
                
                <div class="action-buttons">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save Student
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('addDirectStudentModal')">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Class Details Modal -->
    <div class="modal" id="classDetailsModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('classDetailsModal')">Ã—</button>
            <h2>Class Details</h2>
            
            <div class="class-details-content" id="classDetailsContent">
                <!-- Class details will be loaded here -->
            </div>
            
            <div class="action-buttons" style="margin-top: 20px;">
                <button type="button" class="btn btn-primary" id="editClassBtn">
                    <i class="fas fa-edit"></i> Edit Class
                </button>
                <button type="button" class="btn btn-danger" id="deleteClassBtn">
                    <i class="fas fa-trash"></i> Delete Class
                </button>
                <button type="button" class="btn btn-info" id="addInfoBtn">
                    <i class="fas fa-plus"></i> Add Information
                </button>
                <button type="button" class="btn btn-warning" onclick="closeModal('classDetailsModal')">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAQZ1_Grh00sFgOp8pxkKff10sMFSw9xlc",
            authDomain: "jnnp-system.firebaseapp.com",
            databaseURL: "https://jnnp-system-default-rtdb.firebaseio.com",
            projectId: "jnnp-system",
            storageBucket: "jnnp-system.firebasestorage.app",
            messagingSenderId: "769232855377",
            appId: "1:769232855377:web:e3ba51e3e25cc24735f370"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        // Global Variables
        let allCourses = [];
        let allClasses = [];
        let allTrainers = [];
        let allStudents = [];
        let allDepartments = new Set();
        let classStudentsMap = {};
        let editingClassId = null;
        let selectedTrainerId = null;
        let selectedClassForTrainer = null;
        let selectedClassForStudent = null;
        let selectedStudentId = null;
        let currentClassDetailsId = null;

        // DOM Elements
        const loadingIndicator = document.getElementById('loadingIndicator');
        const classesContainer = document.getElementById('classesContainer');
        const emptyState = document.getElementById('emptyState');
        const successMessage = document.getElementById('successMessage');
        const successText = document.getElementById('successText');
        const totalClassesElement = document.getElementById('totalClasses');
        const totalStudentsElement = document.getElementById('totalStudents');
        const totalTrainersElement = document.getElementById('totalTrainers');
        const totalDepartmentsElement = document.getElementById('totalDepartments');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeClassManagement();
        });

        function initializeClassManagement() {
            setupMobileMenu();
            setupEventListeners();
            populateYearFilter();
            loadAllData();
        }

        function setupMobileMenu() {
            const menuToggle = document.getElementById('menu-toggle');
            const navLinks = document.getElementById('nav-links');

            if (menuToggle) {
                menuToggle.addEventListener('click', () => {
                    navLinks.classList.toggle('active');
                });

                document.querySelectorAll('.dropdown > a').forEach(link => {
                    link.addEventListener('click', function (e) {
                        if (window.innerWidth <= 768) {
                            e.preventDefault();
                            const dropdownContent = this.nextElementSibling;
                            
                            document.querySelectorAll('.dropdown-content').forEach(content => {
                                if (content !== dropdownContent) {
                                    content.classList.remove('show');
                                }
                            });
                            
                            dropdownContent.classList.toggle('show');
                        }
                    });
                });

                document.addEventListener('click', function (e) {
                    if (window.innerWidth <= 768 && !e.target.closest('.dropdown')) {
                        document.querySelectorAll('.dropdown-content').forEach(content => {
                            content.classList.remove('show');
                        });
                    }
                });
            }
        }

        function setupEventListeners() {
            // Filter change listeners
            const filters = ['departmentFilter', 'courseFilter', 'moduleFilter', 'intakeFilter', 'yearFilter'];
            filters.forEach(filterId => {
                document.getElementById(filterId).addEventListener('change', filterClasses);
            });

            // Class form auto-generation
            document.getElementById('classCourse').addEventListener('change', updateClassName);
            document.getElementById('classModule').addEventListener('change', updateClassName);
            document.getElementById('classIntake').addEventListener('change', updateClassName);
            document.getElementById('classYear').addEventListener('change', updateClassName);
            
            // Student search in modal
            document.getElementById('studentSearch').addEventListener('input', function() {
                filterStudentsInModal(this.value.toLowerCase());
            });
            
            // Tab functionality in modals
            setupModalTabs();
        }

        function setupModalTabs() {
            // Setup tabs in add student modal
            const studentModalTabs = document.querySelectorAll('#addStudentModal .modal-tab');
            studentModalTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and contents
                    studentModalTabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('#addStudentModal .modal-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab and corresponding content
                    this.classList.add('active');
                    document.getElementById(tabId + '-tab').classList.add('active');
                });
            });
            
            // Setup tabs in assign trainer modal
            const trainerModalTabs = document.querySelectorAll('#assignTrainerModal .modal-tab');
            trainerModalTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and contents
                    trainerModalTabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('#assignTrainerModal .modal-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab and corresponding content
                    this.classList.add('active');
                    document.getElementById(tabId + '-tab').classList.add('active');
                });
            });
        }

        function populateYearFilter() {
            const yearFilter = document.getElementById('yearFilter');
            const yearSelect = document.getElementById('classYear');
            
            const currentYear = new Date().getFullYear();
            const years = [];
            
            // Generate years from current year - 5 to current year + 5
            for (let i = currentYear - 5; i <= currentYear + 5; i++) {
                years.push(i);
            }
            
            // Clear existing options
            yearFilter.innerHTML = '<option value="all">All Years</option>';
            yearSelect.innerHTML = '<option value="">Select Year</option>';
            
            // Add year options
            years.forEach(year => {
                const option1 = document.createElement('option');
                option1.value = year;
                option1.textContent = year;
                yearFilter.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = year;
                option2.textContent = year;
                yearSelect.appendChild(option2);
            });
            
            // Set current year as default
            yearSelect.value = currentYear;
            updateClassName();
        }

        function loadAllData() {
            // Load courses
            database.ref('courses').on('value', snapshot => {
                allCourses = [];
                const coursesData = snapshot.val();
                
                if (coursesData) {
                    Object.keys(coursesData).forEach(key => {
                        allCourses.push({
                            id: key,
                            ...coursesData[key]
                        });
                    });
                }
                
                console.log("Loaded courses:", allCourses.length);
                updateDepartmentAndCourseFilters();
                filterClasses();
                updateDashboardStats();
            });
            
            // Load classes
            database.ref('classes').on('value', snapshot => {
                allClasses = [];
                const classesData = snapshot.val();
                
                if (classesData) {
                    Object.keys(classesData).forEach(key => {
                        allClasses.push({
                            id: key,
                            ...classesData[key]
                        });
                    });
                }
                
                console.log("Loaded classes:", allClasses.length);
                filterClasses();
                updateDirectClassFilter();
                updateDashboardStats();
            });
            
            // Load trainers
            database.ref('trainers').on('value', snapshot => {
                allTrainers = [];
                const trainersData = snapshot.val();
                
                if (trainersData) {
                    Object.keys(trainersData).forEach(key => {
                        allTrainers.push({
                            id: key,
                            ...trainersData[key]
                        });
                    });
                }
                
                console.log("Loaded trainers:", allTrainers.length);
                updateDashboardStats();
            });
            
            // Load students (from admissions)
            database.ref('admissions').on('value', snapshot => {
                allStudents = [];
                const studentsData = snapshot.val();
                
                if (studentsData) {
                    Object.keys(studentsData).forEach(key => {
                        allStudents.push({
                            id: key,
                            ...studentsData[key]
                        });
                    });
                }
                
                console.log("Loaded students:", allStudents.length);
                updateDashboardStats();
            });
            
            // Load class-student relationships
            database.ref('classStudents').on('value', snapshot => {
                classStudentsMap = {};
                const classStudentsData = snapshot.val();
                
                if (classStudentsData) {
                    Object.keys(classStudentsData).forEach(classId => {
                        classStudentsMap[classId] = classStudentsData[classId];
                    });
                }
                
                console.log("Loaded class-student relationships");
                filterClasses();
            });
        }

        function updateDashboardStats() {
            // Count active classes
            const activeClasses = allClasses.filter(cls => 
                cls.status !== 'Inactive'
            ).length;
            totalClassesElement.textContent = activeClasses;
            
            // Count total students
            totalStudentsElement.textContent = allStudents.length;
            
            // Count active trainers
            const activeTrainers = allTrainers.filter(trainer => 
                trainer.status === 'Active'
            ).length;
            totalTrainersElement.textContent = activeTrainers;
            
            // Count departments
            totalDepartmentsElement.textContent = allDepartments.size;
        }

        function updateDepartmentAndCourseFilters() {
            // Clear existing departments
            allDepartments.clear();
            
            // Collect departments from all courses - FIXED: Use courseDepartment instead of department
            allCourses.forEach(course => {
                if (course.courseDepartment && course.courseDepartment.trim()) {
                    allDepartments.add(course.courseDepartment.trim());
                }
            });
            
            // Also check from existing classes
            allClasses.forEach(cls => {
                if (cls.department && cls.department.trim()) {
                    allDepartments.add(cls.department.trim());
                }
            });
            
            // If no departments found, add default ones
            if (allDepartments.size === 0) {
                const defaultDepartments = [
                    "Computing & Informatics",
                    "Business & Entrepreneurship", 
                    "Electrical & Electronics Engineering",
                    "Mechanical & Automotive Engineering",
                    "Hospitality & Tourism"
                ];
                defaultDepartments.forEach(dept => allDepartments.add(dept));
            }
            
            console.log("Departments found:", Array.from(allDepartments));
            
            // Update all department dropdowns
            updateDepartmentDropdown('departmentFilter', true);
            updateDepartmentDropdown('classDepartment', false);
            updateDepartmentDropdown('directDepartment', false);
            
            // Populate course filters
            updateCourseFilter();
        }

        function updateDepartmentDropdown(dropdownId, includeAllOption) {
            const dropdown = document.getElementById(dropdownId);
            if (!dropdown) return;
            
            const currentValue = dropdown.value;
            dropdown.innerHTML = '';
            
            if (includeAllOption) {
                const allOption = document.createElement('option');
                allOption.value = 'all';
                allOption.textContent = 'All Departments';
                dropdown.appendChild(allOption);
            } else {
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'Select Department';
                dropdown.appendChild(defaultOption);
            }
            
            // Sort departments alphabetically
            const sortedDepartments = Array.from(allDepartments).sort();
            
            sortedDepartments.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                dropdown.appendChild(option);
            });
            
            // Restore previous value if it still exists
            if (currentValue && Array.from(allDepartments).includes(currentValue)) {
                dropdown.value = currentValue;
            }
        }

        function updateCourseFilter() {
            const departmentFilter = document.getElementById('departmentFilter').value;
            const courseFilter = document.getElementById('courseFilter');
            
            const currentValue = courseFilter.value;
            courseFilter.innerHTML = '<option value="all">All Courses</option>';
            
            let filteredCourses = allCourses;
            if (departmentFilter !== 'all') {
                filteredCourses = filteredCourses.filter(course => 
                    course.courseDepartment === departmentFilter
                );
            }
            
            // Sort courses alphabetically
            filteredCourses.sort((a, b) => a.courseName.localeCompare(b.courseName));
            
            filteredCourses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = `${course.courseName} (${course.courseCode || 'No Code'})`;
                courseFilter.appendChild(option);
            });
            
            // Restore previous value if it still exists
            if (currentValue && filteredCourses.some(c => c.id === currentValue)) {
                courseFilter.value = currentValue;
            }
        }

        function updateClassModalCourses() {
            const department = document.getElementById('classDepartment').value;
            const courseSelect = document.getElementById('classCourse');
            
            courseSelect.innerHTML = '<option value="">Select Course</option>';
            
            if (!department) return;
            
            const departmentCourses = allCourses.filter(course => 
                course.courseDepartment === department
            );
            
            departmentCourses.sort((a, b) => a.courseName.localeCompare(b.courseName));
            
            departmentCourses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = `${course.courseName} (${course.courseCode || 'No Code'})`;
                courseSelect.appendChild(option);
            });
            
            // Update class name if module, intake, and year are already set
            updateClassName();
        }

        function updateDirectCourses() {
            const department = document.getElementById('directDepartment').value;
            const courseSelect = document.getElementById('directCourse');
            
            courseSelect.innerHTML = '<option value="">Select Course</option>';
            
            if (!department) return;
            
            const departmentCourses = allCourses.filter(course => 
                course.courseDepartment === department
            );
            
            departmentCourses.sort((a, b) => a.courseName.localeCompare(b.courseName));
            
            departmentCourses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = `${course.courseName} (${course.courseCode || 'No Code'})`;
                courseSelect.appendChild(option);
            });
        }

        function updateDirectClassFilter() {
            const directClass = document.getElementById('directClass');
            directClass.innerHTML = '<option value="">Select Class (Optional)</option>';
            
            allClasses.forEach(cls => {
                if (cls.status === 'Active') {
                    const option = document.createElement('option');
                    option.value = cls.id;
                    option.textContent = cls.className;
                    directClass.appendChild(option);
                }
            });
        }

        function filterClasses() {
            loadingIndicator.style.display = 'none';
            classesContainer.innerHTML = '';
            
            const department = document.getElementById('departmentFilter').value;
            const course = document.getElementById('courseFilter').value;
            const module = document.getElementById('moduleFilter').value;
            const intake = document.getElementById('intakeFilter').value;
            const year = document.getElementById('yearFilter').value;
            
            // Update course filter based on department
            if (department !== 'all') {
                updateCourseFilter();
            }
            
            let filteredClasses = allClasses;
            
            // Apply filters
            if (department !== 'all') {
                filteredClasses = filteredClasses.filter(cls => cls.department === department);
            }
            
            if (course !== 'all') {
                filteredClasses = filteredClasses.filter(cls => cls.courseId === course);
            }
            
            if (module !== 'all') {
                filteredClasses = filteredClasses.filter(cls => cls.module === module);
            }
            
            if (intake !== 'all') {
                filteredClasses = filteredClasses.filter(cls => cls.intake === intake);
            }
            
            if (year !== 'all') {
                filteredClasses = filteredClasses.filter(cls => cls.year == year);
            }
            
            // Sort classes by year (descending), then department, then course, then module
            filteredClasses.sort((a, b) => {
                if (b.year !== a.year) return b.year - a.year;
                if (a.department !== b.department) return a.department.localeCompare(b.department);
                if (a.courseName !== b.courseName) return a.courseName.localeCompare(b.courseName);
                return a.module.localeCompare(b.module);
            });
            
            // Render classes
            if (filteredClasses.length === 0) {
                emptyState.style.display = 'block';
                classesContainer.style.display = 'none';
            } else {
                emptyState.style.display = 'none';
                classesContainer.style.display = 'grid';
                
                filteredClasses.forEach(cls => {
                    const classCard = createClassCard(cls);
                    classesContainer.appendChild(classCard);
                });
            }
        }

        function createClassCard(cls) {
            const card = document.createElement('div');
            card.className = 'class-card';
            
            // Get students for this class
            const classStudents = getStudentsForClass(cls.id);
            const trainer = cls.trainerId ? getTrainerById(cls.trainerId) : null;
            
            card.innerHTML = `
                <div class="class-card-header">
                    <h3>${cls.className}</h3>
                    <div class="class-code">${cls.className}</div>
                    <div class="class-actions">
                        <button class="action-btn" onclick="viewClassDetails('${cls.id}')" title="View Class Details">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn" onclick="editClass('${cls.id}')" title="Edit Class">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="deleteClass('${cls.id}')" title="Delete Class">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="class-card-body">
                    <div class="class-info-grid">
                        <div class="info-box">
                            <div class="info-label">Course</div>
                            <div class="info-value">${cls.courseName}</div>
                        </div>
                        <div class="info-box">
                            <div class="info-label">Module</div>
                            <div class="info-value">Module ${cls.module}</div>
                        </div>
                        <div class="info-box">
                            <div class="info-label">Intake</div>
                            <div class="info-value">${getIntakeFullName(cls.intake)} ${cls.year}</div>
                        </div>
                        <div class="info-box">
                            <div class="info-label">Status</div>
                            <div class="info-value" style="color: ${getStatusColor(cls.status)}">
                                ${cls.status}
                            </div>
                        </div>
                    </div>
                    
                    ${cls.schedule ? `
                        <div class="info-box" style="margin-bottom: 15px;">
                            <div class="info-label">Schedule</div>
                            <div class="info-value">${cls.schedule}</div>
                        </div>
                    ` : ''}
                    
                    ${cls.description ? `
                        <div class="info-box" style="margin-bottom: 15px;">
                            <div class="info-label">Description</div>
                            <div class="info-value">${cls.description}</div>
                        </div>
                    ` : ''}
                    
                    <div class="students-section">
                        <div class="section-title">
                            <span>Students</span>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span class="count-badge">${classStudents.length} / ${cls.capacity || 'âˆž'}</span>
                                <button class="action-btn" onclick="openAddStudentModal('${cls.id}')" title="Add Student">
                                    <i class="fas fa-user-plus"></i>
                                </button>
                            </div>
                        </div>
                        ${classStudents.length > 0 ? `
                            <div class="students-list">
                                ${classStudents.slice(0, 8).map(student => `
                                    <div class="student-item">
                                        <div class="student-avatar">${getInitials(student.fullName)}</div>
                                        <div class="student-info">
                                            <div class="student-name">${student.fullName}</div>
                                            <div class="student-detail">${student.admNo || 'No ID'} â€¢ ${student.email || 'No email'}</div>
                                        </div>
                                        <button class="remove-student" onclick="removeStudentFromClass('${cls.id}', '${student.id}')" title="Remove Student">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                `).join('')}
                                ${classStudents.length > 8 ? `
                                    <div class="student-item" style="justify-content: center; color: #666; font-style: italic;">
                                        + ${classStudents.length - 8} more students
                                    </div>
                                ` : ''}
                            </div>
                        ` : `
                            <div class="empty-state" style="padding: 15px; margin: 0;">
                                <i class="fas fa-user-graduate"></i>
                                <p>No students assigned yet</p>
                                <button class="btn btn-primary" style="margin-top: 10px;" onclick="openAddStudentModal('${cls.id}')">
                                    <i class="fas fa-user-plus"></i> Add Students
                                </button>
                            </div>
                        `}
                    </div>
                    
                    <div class="trainer-section">
                        <div class="section-title">
                            <span>Assigned Trainer</span>
                        </div>
                        ${trainer ? `
                            <div class="trainer-info">
                                <div class="trainer-avatar">${getInitials(trainer.fullName)}</div>
                                <div class="trainer-details">
                                    <div class="trainer-name">${trainer.fullName}</div>
                                    <div class="trainer-qualification">${trainer.qualification || 'No qualification specified'}</div>
                                </div>
                            </div>
                        ` : `
                            <div class="empty-state" style="padding: 10px; margin: 0;">
                                <i class="fas fa-chalkboard-teacher"></i>
                                <p>No trainer assigned</p>
                            </div>
                        `}
                        <button class="btn btn-primary assign-trainer-btn" onclick="openAssignTrainerModal('${cls.id}')">
                            <i class="fas fa-user-plus"></i> ${trainer ? 'Change Trainer' : 'Assign Trainer'}
                        </button>
                    </div>
                    
                    <div class="view-class-btn">
                        <button class="btn btn-info" onclick="viewClassDetails('${cls.id}')">
                            <i class="fas fa-eye"></i> View Full Class Details
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        function getStudentsForClass(classId) {
            const studentIds = classStudentsMap[classId] || {};
            const studentIdList = Object.keys(studentIds);
            
            return allStudents.filter(student => 
                studentIds[student.id] === true
            );
        }

        function getTrainerById(trainerId) {
            return allTrainers.find(trainer => trainer.id === trainerId);
        }

        function getStatusColor(status) {
            switch(status) {
                case 'Active': return '#28a745';
                case 'Inactive': return '#6c757d';
                case 'Completed': return '#007bff';
                default: return '#333';
            }
        }

        function getIntakeFullName(intakeCode) {
            switch(intakeCode) {
                case 'JAN': return 'January';
                case 'MAY': return 'May';
                case 'SEP': return 'September';
                default: return intakeCode;
            }
        }

        function getInitials(name) {
            if (!name) return '??';
            return name.split(' ')
                .map(word => word.charAt(0))
                .join('')
                .toUpperCase()
                .substring(0, 2);
        }

        // Modal Functions
        function openAddClassModal() {
            editingClassId = null;
            document.getElementById('modalTitle').textContent = 'Add New Class';
            document.getElementById('classForm').reset();
            document.getElementById('classStatus').value = 'Active';
            updateClassModalCourses();
            updateClassName();
            showModal('classModal');
        }

        function editClass(classId) {
            const cls = allClasses.find(c => c.id === classId);
            if (!cls) return;
            
            editingClassId = classId;
            document.getElementById('modalTitle').textContent = 'Edit Class';
            
            // Populate form
            document.getElementById('classDepartment').value = cls.department;
            
            // Trigger course population for this department
            updateClassModalCourses();
            
            setTimeout(() => {
                document.getElementById('classCourse').value = cls.courseId;
                document.getElementById('classModule').value = cls.module;
                document.getElementById('classIntake').value = cls.intake;
                document.getElementById('classYear').value = cls.year;
                document.getElementById('classCapacity').value = cls.capacity || 30;
                document.getElementById('className').value = cls.className;
                document.getElementById('classDescription').value = cls.description || '';
                document.getElementById('classSchedule').value = cls.schedule || '';
                document.getElementById('classStatus').value = cls.status || 'Active';
                
                showModal('classModal');
            }, 100);
        }

        function viewClassDetails(classId) {
            const cls = allClasses.find(c => c.id === classId);
            if (!cls) return;
            
            currentClassDetailsId = classId;
            const classStudents = getStudentsForClass(classId);
            const trainer = cls.trainerId ? getTrainerById(cls.trainerId) : null;
            const course = allCourses.find(c => c.id === cls.courseId);
            
            const detailsContent = document.getElementById('classDetailsContent');
            detailsContent.innerHTML = `
                <div class="details-grid">
                    <div class="detail-item">
                        <h4>Class Information</h4>
                        <p><strong>Class Name:</strong> ${cls.className}</p>
                        <p><strong>Course:</strong> ${cls.courseName}</p>
                        <p><strong>Department:</strong> ${cls.department}</p>
                        <p><strong>Module:</strong> Module ${cls.module}</p>
                        <p><strong>Intake:</strong> ${getIntakeFullName(cls.intake)} ${cls.year}</p>
                        <p><strong>Status:</strong> <span style="color: ${getStatusColor(cls.status)}">${cls.status}</span></p>
                        <p><strong>Capacity:</strong> ${classStudents.length} / ${cls.capacity || 'Unlimited'}</p>
                    </div>
                    
                    <div class="detail-item">
                        <h4>Schedule & Details</h4>
                        <p><strong>Schedule:</strong> ${cls.schedule || 'Not specified'}</p>
                        <p><strong>Course Code:</strong> ${cls.courseCode || 'Not specified'}</p>
                        <p><strong>Exam Body:</strong> ${course?.examBody || 'Not specified'}</p>
                        <p><strong>Annual Fee:</strong> ${course?.annualTuition ? 'KES ' + course.annualTuition.toLocaleString() : 'Not specified'}</p>
                        <p><strong>Semester Fee:</strong> ${course?.semesterFee ? 'KES ' + course.semesterFee.toLocaleString() : 'Not specified'}</p>
                    </div>
                    
                    <div class="detail-item">
                        <h4>Trainer Information</h4>
                        ${trainer ? `
                            <p><strong>Name:</strong> ${trainer.fullName}</p>
                            <p><strong>Qualification:</strong> ${trainer.qualification || 'Not specified'}</p>
                            <p><strong>Email:</strong> ${trainer.email || 'Not specified'}</p>
                            <p><strong>Phone:</strong> ${trainer.phone || 'Not specified'}</p>
                            <p><strong>Status:</strong> ${trainer.status || 'Not specified'}</p>
                        ` : '<p>No trainer assigned</p>'}
                    </div>
                    
                    <div class="detail-item">
                        <h4>Class Description</h4>
                        <p>${cls.description || 'No description provided'}</p>
                    </div>
                </div>
                
                <div class="section-title" style="margin-top: 30px;">
                    <span>Student Roster (${classStudents.length} students)</span>
                </div>
                
                ${classStudents.length > 0 ? `
                    <div class="students-list" style="max-height: 300px;">
                        ${classStudents.map(student => `
                            <div class="student-item">
                                <div class="student-avatar">${getInitials(student.fullName)}</div>
                                <div class="student-info">
                                    <div class="student-name">${student.fullName}</div>
                                    <div class="student-detail">
                                        ${student.admNo || 'No ID'} â€¢ 
                                        ${student.email || 'No email'} â€¢ 
                                        ${student.phone || 'No phone'}
                                    </div>
                                </div>
                                <button class="remove-student" onclick="removeStudentFromClass('${classId}', '${student.id}')" title="Remove Student">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `).join('')}
                    </div>
                ` : `
                    <div class="empty-state" style="padding: 20px; margin: 0;">
                        <i class="fas fa-user-graduate"></i>
                        <p>No students in this class yet</p>
                    </div>
                `}
                
                <div class="detail-actions">
                    <button class="btn btn-primary" onclick="openAddStudentModal('${classId}')">
                        <i class="fas fa-user-plus"></i> Add Students
                    </button>
                    <button class="btn btn-success" onclick="openAssignTrainerModal('${classId}')">
                        <i class="fas fa-chalkboard-teacher"></i> ${trainer ? 'Change Trainer' : 'Assign Trainer'}
                    </button>
                </div>
            `;
            
            // Set up button event listeners
            document.getElementById('editClassBtn').onclick = () => {
                closeModal('classDetailsModal');
                setTimeout(() => editClass(classId), 300);
            };
            
            document.getElementById('deleteClassBtn').onclick = () => {
                if (confirm('Are you sure you want to delete this class?')) {
                    deleteClass(classId);
                    closeModal('classDetailsModal');
                }
            };
            
            document.getElementById('addInfoBtn').onclick = () => {
                closeModal('classDetailsModal');
                setTimeout(() => {
                    editClass(classId);
                }, 300);
            };
            
            showModal('classDetailsModal');
        }

        function updateClassName() {
            const courseId = document.getElementById('classCourse').value;
            const module = document.getElementById('classModule').value;
            const intake = document.getElementById('classIntake').value;
            const year = document.getElementById('classYear').value;
            
            if (courseId && module && intake && year) {
                const course = allCourses.find(c => c.id === courseId);
                if (course) {
                    // Extract course code (e.g., DCS from DCS201)
                    let courseCode = course.courseCode || '';
                    // If course code has numbers, remove them
                    courseCode = courseCode.replace(/[0-9]/g, '');
                    
                    // If no course code, use first 3 letters of course name
                    if (!courseCode || courseCode.length < 2) {
                        courseCode = course.courseName.substring(0, 3).toUpperCase().replace(/[^A-Z]/g, '');
                    }
                    
                    // Ensure module is 2 digits (pad with 0 if needed)
                    const moduleFormatted = module.toString().padStart(2, '0');
                    
                    // Get last 2 digits of year
                    const yearShort = year.toString().slice(-2);
                    
                    // Format: CourseCode + Module + IntakeShort + YearShort
                    // e.g., DS01JAN21 for Driving School, Module 1, January 2021
                    const className = `${courseCode}${moduleFormatted}${intake}${yearShort}`;
                    document.getElementById('className').value = className;
                }
            }
        }

        function saveClass(event) {
            event.preventDefault();
            
            const courseId = document.getElementById('classCourse').value;
            const course = allCourses.find(c => c.id === courseId);
            
            if (!course) {
                showMessage('Please select a valid course', 'error');
                return;
            }
            
            const classData = {
                department: document.getElementById('classDepartment').value,
                courseId: courseId,
                courseName: course.courseName,
                courseCode: course.courseCode,
                module: document.getElementById('classModule').value,
                intake: document.getElementById('classIntake').value,
                year: parseInt(document.getElementById('classYear').value),
                capacity: parseInt(document.getElementById('classCapacity').value) || 30,
                className: document.getElementById('className').value,
                description: document.getElementById('classDescription').value,
                schedule: document.getElementById('classSchedule').value,
                status: document.getElementById('classStatus').value,
                updatedAt: new Date().toISOString()
            };
            
            if (editingClassId) {
                // Update existing class
                database.ref('classes/' + editingClassId).update(classData)
                    .then(() => {
                        showMessage('Class updated successfully!', 'success');
                        closeModal('classModal');
                    })
                    .catch(error => {
                        showMessage('Error updating class: ' + error.message, 'error');
                    });
            } else {
                // Add new class
                classData.createdAt = new Date().toISOString();
                classData.createdBy = 'Admin';
                
                database.ref('classes').push(classData)
                    .then(() => {
                        showMessage('Class added successfully!', 'success');
                        closeModal('classModal');
                        document.getElementById('classForm').reset();
                        updateClassName();
                    })
                    .catch(error => {
                        showMessage('Error adding class: ' + error.message, 'error');
                    });
            }
        }

        function deleteClass(classId) {
            if (confirm('Are you sure you want to delete this class? This will also remove all student assignments to this class.')) {
                // Delete class
                database.ref('classes/' + classId).remove()
                    .then(() => {
                        // Delete class-student relationships
                        database.ref('classStudents/' + classId).remove()
                            .then(() => {
                                showMessage('Class deleted successfully!', 'success');
                            })
                            .catch(error => {
                                showMessage('Class deleted but error removing student assignments: ' + error.message, 'warning');
                            });
                    })
                    .catch(error => {
                        showMessage('Error deleting class: ' + error.message, 'error');
                    });
            }
        }

        // Student Assignment Functions
        function openAddStudentModal(classId) {
            const cls = allClasses.find(c => c.id === classId);
            if (!cls) return;
            
            selectedClassForStudent = classId;
            document.getElementById('selectedClassForStudent').value = cls.className;
            document.getElementById('selectedClassIdForStudent').value = classId;
            
            // Set department and course for new student form
            document.getElementById('newStudentDepartment').value = cls.department;
            document.getElementById('newStudentCourse').value = cls.courseName;
            
            selectedStudentId = null;
            document.getElementById('studentSearch').value = '';
            
            // Reset tabs to first tab
            document.querySelectorAll('#addStudentModal .modal-tab').forEach((tab, index) => {
                tab.classList.remove('active');
                if (index === 0) tab.classList.add('active');
            });
            
            document.querySelectorAll('#addStudentModal .modal-tab-content').forEach((content, index) => {
                content.classList.remove('active');
                if (index === 0) content.classList.add('active');
            });
            
            // Get students already in this class
            const currentStudentIds = classStudentsMap[classId] ? Object.keys(classStudentsMap[classId]) : [];
            
            // Filter students - show all admitted students (status = "Admitted")
            const availableStudents = allStudents.filter(student => {
                // Check if student is already in this class
                if (currentStudentIds.includes(student.id)) return false;
                
                // Check if student is admitted
                if (student.status === 'Admitted') {
                    return true;
                }
                
                return false;
            });
            
            const studentsListModal = document.getElementById('studentsListModal');
            studentsListModal.innerHTML = '';
            
            if (availableStudents.length === 0) {
                studentsListModal.innerHTML = `
                    <div class="empty-state" style="padding: 20px; margin: 0;">
                        <i class="fas fa-user-graduate"></i>
                        <p>No admitted students available</p>
                        <p>Switch to "Add New Student" tab to create one</p>
                    </div>
                `;
            } else {
                availableStudents.forEach(student => {
                    const studentOption = document.createElement('div');
                    studentOption.className = 'student-option';
                    studentOption.onclick = () => selectStudent(student.id, studentOption);
                    
                    studentOption.innerHTML = `
                        <div class="student-option-avatar">${getInitials(student.fullName)}</div>
                        <div class="student-option-info">
                            <div class="student-option-name">${student.fullName}</div>
                            <div class="student-option-details">
                                ${student.admNo || 'No ID'} â€¢ 
                                ${student.email || 'No email'} â€¢ 
                                ${student.phone || 'No phone'}
                            </div>
                        </div>
                    `;
                    
                    studentsListModal.appendChild(studentOption);
                });
            }
            
            showModal('addStudentModal');
        }

        function filterStudentsInModal(searchTerm) {
            const studentOptions = document.querySelectorAll('.student-option');
            
            studentOptions.forEach(option => {
                const studentName = option.querySelector('.student-option-name').textContent.toLowerCase();
                const studentDetails = option.querySelector('.student-option-details').textContent.toLowerCase();
                
                if (studentName.includes(searchTerm) || studentDetails.includes(searchTerm)) {
                    option.style.display = 'flex';
                } else {
                    option.style.display = 'none';
                }
            });
        }

        function selectStudent(studentId, element) {
            // Remove selection from all options
            document.querySelectorAll('.student-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selection to clicked option
            element.classList.add('selected');
            selectedStudentId = studentId;
        }

        function addSelectedStudent() {
            if (!selectedStudentId || !selectedClassForStudent) {
                showMessage('Please select a student first', 'error');
                return;
            }
            
            const student = allStudents.find(s => s.id === selectedStudentId);
            if (!student) {
                showMessage('Selected student not found', 'error');
                return;
            }
            
            // Add student to class
            database.ref('classStudents/' + selectedClassForStudent + '/' + selectedStudentId).set(true)
                .then(() => {
                    showMessage(`Student ${student.fullName} added to class successfully!`, 'success');
                    closeModal('addStudentModal');
                    selectedStudentId = null;
                    selectedClassForStudent = null;
                })
                .catch(error => {
                    showMessage('Error adding student: ' + error.message, 'error');
                });
        }

        function addNewStudentToClass(event) {
            event.preventDefault();
            
            if (!selectedClassForStudent) {
                showMessage('No class selected', 'error');
                return;
            }
            
            const cls = allClasses.find(c => c.id === selectedClassForStudent);
            if (!cls) {
                showMessage('Class not found', 'error');
                return;
            }
            
            const studentData = {
                fullName: document.getElementById('newStudentFullName').value.trim(),
                email: document.getElementById('newStudentEmail').value.trim(),
                phone: document.getElementById('newStudentPhone').value.trim() || '',
                admNo: document.getElementById('newStudentAdmNo').value.trim(),
                status: 'Admitted',
                courseId: cls.courseId,
                courseName: cls.courseName,
                courseCode: cls.courseCode,
                department: cls.department,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Check if admission number already exists
            const existingStudent = allStudents.find(s => s.admNo === studentData.admNo);
            if (existingStudent) {
                showMessage(`Admission number ${studentData.admNo} already exists!`, 'error');
                return;
            }
            
            // Save student to admissions
            const newStudentRef = database.ref('admissions').push();
            newStudentRef.set(studentData)
                .then(() => {
                    const studentId = newStudentRef.key;
                    
                    // Add student to class
                    database.ref('classStudents/' + selectedClassForStudent + '/' + studentId).set(true)
                        .then(() => {
                            showMessage(`Student ${studentData.fullName} added and assigned to class successfully!`, 'success');
                            closeModal('addStudentModal');
                            
                            // Reset form
                            document.getElementById('newStudentInClassForm').reset();
                        })
                        .catch(error => {
                            showMessage('Student added but error assigning to class: ' + error.message, 'warning');
                            closeModal('addStudentModal');
                        });
                })
                .catch(error => {
                    showMessage('Error adding student: ' + error.message, 'error');
                });
        }

        function removeStudentFromClass(classId, studentId) {
            if (confirm('Are you sure you want to remove this student from the class?')) {
                database.ref('classStudents/' + classId + '/' + studentId).remove()
                    .then(() => {
                        showMessage('Student removed from class successfully!', 'success');
                    })
                    .catch(error => {
                        showMessage('Error removing student: ' + error.message, 'error');
                    });
            }
        }

        // Direct Student Addition
        function openAddDirectStudentModal() {
            document.getElementById('directStudentForm').reset();
            document.getElementById('directStatus').value = 'Admitted';
            showModal('addDirectStudentModal');
        }

        function saveDirectStudent(event) {
            event.preventDefault();
            
            const studentData = {
                fullName: document.getElementById('directFullName').value.trim(),
                email: document.getElementById('directEmail').value.trim(),
                phone: document.getElementById('directPhone').value.trim() || '',
                admNo: document.getElementById('directAdmNo').value.trim(),
                status: document.getElementById('directStatus').value,
                notes: document.getElementById('directNotes').value.trim() || '',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            const courseId = document.getElementById('directCourse').value;
            const course = allCourses.find(c => c.id === courseId);
            
            if (!course) {
                showMessage('Please select a valid course', 'error');
                return;
            }
            
            studentData.courseId = courseId;
            studentData.courseName = course.courseName;
            studentData.courseCode = course.courseCode;
            studentData.department = course.courseDepartment;
            
            // Check if admission number already exists
            const existingStudent = allStudents.find(s => s.admNo === studentData.admNo);
            if (existingStudent) {
                showMessage(`Admission number ${studentData.admNo} already exists!`, 'error');
                return;
            }
            
            // Save student
            const newStudentRef = database.ref('admissions').push();
            newStudentRef.set(studentData)
                .then(() => {
                    const studentId = newStudentRef.key;
                    
                    // Assign to class if selected
                    const classId = document.getElementById('directClass').value;
                    if (classId) {
                        database.ref('classStudents/' + classId + '/' + studentId).set(true)
                            .then(() => {
                                showMessage(`Student ${studentData.fullName} added and assigned to class successfully!`, 'success');
                                closeModal('addDirectStudentModal');
                            })
                            .catch(error => {
                                showMessage('Student added but error assigning to class: ' + error.message, 'warning');
                                closeModal('addDirectStudentModal');
                            });
                    } else {
                        showMessage(`Student ${studentData.fullName} added successfully!`, 'success');
                        closeModal('addDirectStudentModal');
                    }
                })
                .catch(error => {
                    showMessage('Error adding student: ' + error.message, 'error');
                });
        }

        // Trainer Assignment Functions
        function openAssignTrainerModal(classId) {
            const cls = allClasses.find(c => c.id === classId);
            if (!cls) return;
            
            selectedClassForTrainer = classId;
            document.getElementById('selectedClassName').value = cls.className;
            document.getElementById('selectedClassId').value = classId;
            
            // Set department in new trainer form
            document.getElementById('newTrainerDepartment').value = cls.department;
            
            // Reset tabs to first tab
            document.querySelectorAll('#assignTrainerModal .modal-tab').forEach((tab, index) => {
                tab.classList.remove('active');
                if (index === 0) tab.classList.add('active');
            });
            
            document.querySelectorAll('#assignTrainerModal .modal-tab-content').forEach((content, index) => {
                content.classList.remove('active');
                if (index === 0) content.classList.add('active');
            });
            
            // Filter trainers by department - FIXED: Use department from trainer object
            const departmentTrainers = allTrainers.filter(trainer => {
                // Check if trainer has department field
                if (trainer.department && trainer.department.trim() && trainer.status === 'Active') {
                    return trainer.department === cls.department;
                }
                return false;
            });
            
            const trainersList = document.getElementById('trainersList');
            trainersList.innerHTML = '';
            
            if (departmentTrainers.length === 0) {
                trainersList.innerHTML = `
                    <div class="empty-state" style="padding: 20px; margin: 0;">
                        <i class="fas fa-users-slash"></i>
                        <p>No active trainers found in ${cls.department} department</p>
                        <p>Switch to "Add New Trainer" tab to create one</p>
                    </div>
                `;
            } else {
                departmentTrainers.forEach(trainer => {
                    const trainerOption = document.createElement('div');
                    trainerOption.className = `trainer-option ${cls.trainerId === trainer.id ? 'selected' : ''}`;
                    trainerOption.onclick = () => selectTrainer(trainer.id, trainerOption);
                    
                    trainerOption.innerHTML = `
                        <div class="trainer-option-avatar">${getInitials(trainer.fullName)}</div>
                        <div class="trainer-option-info">
                            <div class="trainer-option-name">${trainer.fullName}</div>
                            <div class="trainer-option-details">
                                ${trainer.qualification || 'No qualification'} â€¢ 
                                ${trainer.email || 'No email'} â€¢ 
                                ${trainer.phone || 'No phone'}
                            </div>
                        </div>
                    `;
                    
                    trainersList.appendChild(trainerOption);
                    
                    if (cls.trainerId === trainer.id) {
                        selectedTrainerId = trainer.id;
                    }
                });
            }
            
            showModal('assignTrainerModal');
        }

        function selectTrainer(trainerId, element) {
            // Remove selection from all options
            document.querySelectorAll('.trainer-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selection to clicked option
            element.classList.add('selected');
            selectedTrainerId = trainerId;
        }

        function assignSelectedTrainer() {
            if (!selectedTrainerId || !selectedClassForTrainer) {
                showMessage('Please select a trainer', 'error');
                return;
            }
            
            const trainer = allTrainers.find(t => t.id === selectedTrainerId);
            if (!trainer) {
                showMessage('Selected trainer not found', 'error');
                return;
            }
            
            database.ref('classes/' + selectedClassForTrainer).update({
                trainerId: selectedTrainerId,
                trainerName: trainer.fullName,
                trainerAssignedAt: new Date().toISOString()
            })
            .then(() => {
                showMessage(`Trainer ${trainer.fullName} assigned successfully!`, 'success');
                closeModal('assignTrainerModal');
            })
            .catch(error => {
                showMessage('Error assigning trainer: ' + error.message, 'error');
            });
        }

        function addNewTrainer(event) {
            event.preventDefault();
            
            if (!selectedClassForTrainer) {
                showMessage('No class selected', 'error');
                return;
            }
            
            const cls = allClasses.find(c => c.id === selectedClassForTrainer);
            if (!cls) {
                showMessage('Class not found', 'error');
                return;
            }
            
            const trainerData = {
                fullName: document.getElementById('newTrainerFullName').value.trim(),
                email: document.getElementById('newTrainerEmail').value.trim(),
                phone: document.getElementById('newTrainerPhone').value.trim(),
                qualification: document.getElementById('newTrainerQualification').value.trim(),
                department: cls.department,
                regNo: document.getElementById('newTrainerRegNo').value.trim() || '',
                status: 'Active',
                timestamp: Date.now()
            };
            
            // Save trainer to database
            const newTrainerRef = database.ref('trainers').push();
            newTrainerRef.set(trainerData)
                .then(() => {
                    const trainerId = newTrainerRef.key;
                    
                    // Assign trainer to class
                    database.ref('classes/' + selectedClassForTrainer).update({
                        trainerId: trainerId,
                        trainerName: trainerData.fullName,
                        trainerAssignedAt: new Date().toISOString()
                    })
                    .then(() => {
                        showMessage(`Trainer ${trainerData.fullName} added and assigned successfully!`, 'success');
                        closeModal('assignTrainerModal');
                        
                        // Reset form
                        document.getElementById('newTrainerForm').reset();
                    })
                    .catch(error => {
                        showMessage('Trainer added but error assigning to class: ' + error.message, 'warning');
                        closeModal('assignTrainerModal');
                    });
                })
                .catch(error => {
                    showMessage('Error adding trainer: ' + error.message, 'error');
                });
        }

        // Initialize Sample Data
        function initializeSampleData() {
            if (confirm("This will add sample courses and classes to your database. Continue?")) {
                // Add sample courses for all departments
                const sampleCourses = [
                    // Computing & Informatics
                    {
                        courseCode: "DCS",
                        courseName: "Diploma in Computer Science",
                        courseLevel: "Diploma",
                        courseDepartment: "Computing & Informatics",
                        examBody: "KNEC",
                        annualTuition: 120000,
                        semesterFee: 60000,
                        courseDescription: "Comprehensive computer science training covering software development, networking, and system administration.",
                        createdAt: new Date().toISOString()
                    },
                    {
                        courseCode: "CIT",
                        courseName: "Certificate in Information Technology",
                        courseLevel: "Certificate",
                        courseDepartment: "Computing & Informatics",
                        examBody: "KNEC",
                        annualTuition: 80000,
                        semesterFee: 40000,
                        courseDescription: "Fundamental IT skills and computer applications training.",
                        createdAt: new Date().toISOString()
                    },
                    // Business & Entrepreneurship
                    {
                        courseCode: "DBM",
                        courseName: "Diploma in Business Management",
                        courseLevel: "Diploma",
                        courseDepartment: "Business & Entrepreneurship",
                        examBody: "KNEC",
                        annualTuition: 100000,
                        semesterFee: 50000,
                        courseDescription: "Business administration and management skills for modern enterprises.",
                        createdAt: new Date().toISOString()
                    },
                    {
                        courseCode: "CBM",
                        courseName: "Certificate in Business Management",
                        courseLevel: "Certificate",
                        courseDepartment: "Business & Entrepreneurship",
                        examBody: "KNEC",
                        annualTuition: 70000,
                        semesterFee: 35000,
                        courseDescription: "Basic business administration and office management skills.",
                        createdAt: new Date().toISOString()
                    },
                    // Electrical & Electronics Engineering
                    {
                        courseCode: "DEE",
                        courseName: "Diploma in Electrical & Electronics Engineering",
                        courseLevel: "Diploma",
                        courseDepartment: "Electrical & Electronics Engineering",
                        examBody: "KNEC",
                        annualTuition: 150000,
                        semesterFee: 75000,
                        courseDescription: "Training in electrical systems, electronics, and power engineering.",
                        createdAt: new Date().toISOString()
                    },
                    {
                        courseCode: "CEE",
                        courseName: "Certificate in Electrical Engineering",
                        courseLevel: "Certificate",
                        courseDepartment: "Electrical & Electronics Engineering",
                        examBody: "KNEC",
                        annualTuition: 90000,
                        semesterFee: 45000,
                        courseDescription: "Basic electrical installation and maintenance skills.",
                        createdAt: new Date().toISOString()
                    },
                    // Mechanical & Automotive Engineering
                    {
                        courseCode: "DME",
                        courseName: "Diploma in Mechanical Engineering",
                        courseLevel: "Diploma",
                        courseDepartment: "Mechanical & Automotive Engineering",
                        examBody: "KNEC",
                        annualTuition: 140000,
                        semesterFee: 70000,
                        courseDescription: "Training in mechanical systems, automotive technology, and maintenance.",
                        createdAt: new Date().toISOString()
                    },
                    {
                        courseCode: "CME",
                        courseName: "Certificate in Automotive Engineering",
                        courseLevel: "Certificate",
                        courseDepartment: "Mechanical & Automotive Engineering",
                        examBody: "KNEC",
                        annualTuition: 85000,
                        semesterFee: 42500,
                        courseDescription: "Basic automotive repair and maintenance skills.",
                        createdAt: new Date().toISOString()
                    },
                    // Hospitality & Tourism
                    {
                        courseCode: "DHT",
                        courseName: "Diploma in Hospitality Management",
                        courseLevel: "Diploma",
                        courseDepartment: "Hospitality & Tourism",
                        examBody: "KNEC",
                        annualTuition: 110000,
                        semesterFee: 55000,
                        courseDescription: "Comprehensive training in hotel management, tourism, and hospitality services.",
                        createdAt: new Date().toISOString()
                    },
                    {
                        courseCode: "CHT",
                        courseName: "Certificate in Tourism Management",
                        courseLevel: "Certificate",
                        courseDepartment: "Hospitality & Tourism",
                        examBody: "KNEC",
                        annualTuition: 75000,
                        semesterFee: 37500,
                        courseDescription: "Basic tourism and travel agency management skills.",
                        createdAt: new Date().toISOString()
                    }
                ];
                
                // Add sample courses
                sampleCourses.forEach((course, index) => {
                    setTimeout(() => {
                        database.ref('courses').push(course)
                            .then(() => {
                                console.log(`Added: ${course.courseName}`);
                            })
                            .catch(error => {
                                console.error('Error adding course:', error);
                            });
                    }, index * 100);
                });
                
                showMessage('Sample courses added successfully! The page will refresh in 3 seconds.', 'success');
                
                // Refresh the page after 3 seconds
                setTimeout(() => {
                    location.reload();
                }, 3000);
            }
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
            
            if (modalId === 'assignTrainerModal') {
                selectedTrainerId = null;
                selectedClassForTrainer = null;
            }
            if (modalId === 'addStudentModal') {
                selectedStudentId = null;
                selectedClassForStudent = null;
                document.getElementById('studentSearch').value = '';
            }
            if (modalId === 'classDetailsModal') {
                currentClassDetailsId = null;
            }
        }

        function showMessage(message, type) {
            successText.textContent = message;
            
            if (type === 'error') {
                successMessage.style.background = '#dc3545';
            } else if (type === 'success') {
                successMessage.style.background = '#28a745';
            } else if (type === 'warning') {
                successMessage.style.background = '#ffc107';
            } else {
                successMessage.style.background = '#007bff';
            }
            
            successMessage.classList.add('show');
            
            setTimeout(() => {
                successMessage.classList.remove('show');
            }, 3000);
        }

        function refreshData() {
            loadingIndicator.style.display = 'block';
            classesContainer.innerHTML = '';
            emptyState.style.display = 'none';
            
            // Force reload all data
            loadAllData();
            showMessage('Data refreshed successfully!', 'success');
            
            setTimeout(() => {
                loadingIndicator.style.display = 'none';
            }, 1000);
        }

        function exportToExcel() {
            const department = document.getElementById('departmentFilter').value;
            const course = document.getElementById('courseFilter').value;
            const module = document.getElementById('moduleFilter').value;
            const intake = document.getElementById('intakeFilter').value;
            const year = document.getElementById('yearFilter').value;
            
            let filteredClasses = allClasses;
            
            if (department !== 'all') {
                filteredClasses = filteredClasses.filter(cls => cls.department === department);
            }
            if (course !== 'all') {
                filteredClasses = filteredClasses.filter(cls => cls.courseId === course);
            }
            if (module !== 'all') {
                filteredClasses = filteredClasses.filter(cls => cls.module === module);
            }
            if (intake !== 'all') {
                filteredClasses = filteredClasses.filter(cls => cls.intake === intake);
            }
            if (year !== 'all') {
                filteredClasses = filteredClasses.filter(cls => cls.year == year);
            }
            
            const data = filteredClasses.map(cls => {
                const students = getStudentsForClass(cls.id);
                const trainer = cls.trainerId ? getTrainerById(cls.trainerId) : null;
                
                return {
                    'Class Name': cls.className,
                    'Course': cls.courseName,
                    'Department': cls.department,
                    'Module': cls.module,
                    'Intake': getIntakeFullName(cls.intake),
                    'Year': cls.year,
                    'Status': cls.status,
                    'Capacity': cls.capacity || 'N/A',
                    'Schedule': cls.schedule || 'N/A',
                    'Trainer': trainer ? trainer.fullName : 'Not Assigned',
                    'Students Count': students.length,
                    'Description': cls.description || ''
                };
            });
            
            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Classes Report');
            
            const fileName = `UCST_Classes_Report_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(workbook, fileName);
            
            showMessage('Exported to Excel successfully!', 'success');
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = 'auto';
                
                if (event.target.id === 'assignTrainerModal') {
                    selectedTrainerId = null;
                    selectedClassForTrainer = null;
                }
                if (event.target.id === 'addStudentModal') {
                    selectedStudentId = null;
                    selectedClassForStudent = null;
                    document.getElementById('studentSearch').value = '';
                }
                if (event.target.id === 'classDetailsModal') {
                    currentClassDetailsId = null;
                }
            }
        };

        // Close modals with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                });
            }
        });

        // Auto-refresh data every 60 seconds
        setInterval(() => {
            console.log('Auto-refreshing class data...');
            loadAllData();
        }, 60000);
    </script>
</body>
</html>